<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>结构化产品生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>
    <!-- 更新PPTXGenJS库到最新版本 -->
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <style>
        .table-header {
            background-color: #004aad;
            color: white;
        }
        .chart-container {
            height: 250px;
            min-height: 200px;
            max-height: 600px;
            width: 100%;
            min-width: 200px;
            max-width: 800px;
            position: relative;
            resize: both;
            overflow: auto;
        }
        .chart-title {
            background-color: #004aad;
            color: white;
            padding: 6px 10px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 8px;
        }
        .direction-label {
            background-color: #004aad;
            color: white;
            padding: 4px 8px;
            font-weight: bold;
            position: relative;
            top: auto;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            font-size: 16px;
            border-radius: 4px;
            margin-bottom: 8px;
            width: fit-content;
            display: block;
        }
        /* 图表容器的父元素样式 */
        .relative {
            position: relative; /* 使方向标签相对于此容器定位 */
        }
        .highlight-text {
            color: #e63946;
            font-weight: bold;
        }
        /* 报价核心要素参考表格样式 */
        .reference-table {
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 8px;
            overflow: hidden;
        }
        .reference-table th,
        .reference-table td {
            border: 1px solid #e5e7eb;
        }
        .reference-table th:first-child {
            border-top-left-radius: 8px;
        }
        .reference-table th:last-child {
            border-top-right-radius: 8px;
        }
        .reference-table tr:last-child td:first-child {
            border-bottom-left-radius: 8px;
        }
        .reference-table tr:last-child td:last-child {
            border-bottom-right-radius: 8px;
        }
        /* 收益情况样式优化 */
        .return-section {
            margin-bottom: 8px;
        }
        .return-condition {
            font-weight: bold;
            margin-bottom: 4px;
            white-space: normal;
            word-wrap: break-word;
            line-height: 1.4;
            color: #004aad;
        }
        .return-result {
            margin-left: 16px;
        }
        /* 加载状态样式 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* 标签页样式 */
        .tab-button {
            padding: 8px 16px;
            cursor: pointer;
            border: 1px solid #ddd;
            background-color: #f1f1f1;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            margin-right: 4px;
            font-weight: bold;
        }
        .tab-button.active {
            background-color: #004aad;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100 p-5">
    <div class="max-w-7xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <!-- 产品类型切换 -->
        <div class="mb-4 border-b border-gray-200">
            <button class="tab-button active transition-all duration-300" onclick="switchTab('sharkfin', event)">鲨鱼鳍结构</button>
            <button class="tab-button transition-all duration-300 hover:bg-[#f0f7ff] hover:text-[#004aad]" onclick="switchTab('binary', event)">二元结构</button>
            <button class="tab-button transition-all duration-300 hover:bg-[#f0f7ff] hover:text-[#004aad]" onclick="switchTab('spread', event)">价差结构</button>
            <button class="tab-button transition-all duration-300 hover:bg-[#f0f7ff] hover:text-[#004aad]" onclick="switchTab('vanilla', event)">香草结构</button>
            <button class="tab-button transition-all duration-300 hover:bg-[#f0f7ff] hover:text-[#004aad]" onclick="switchTab('autocall', event)">自动赎回结构</button>
        </div>

        <!-- 鲨鱼鳍结构内容 -->
        <div id="sharkfin-content" class="tab-content active">
            <!-- 输入区域 -->
            <div class="mb-8 p-5 border border-gray-200 rounded-xl shadow-sm">
                <h2 class="text-xl font-bold mb-4">报价要素输入</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block mb-1 font-medium">产品方向</label>
                        <select id="sharkfin-productDirection" class="w-full p-2 border border-gray-300 rounded">
                            <option value="bull">看涨鲨鱼鳍</option>
                            <option value="bear">看跌鲨鱼鳍</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">挂钩标的</label>
                        <select id="sharkfin-underlying" class="w-full p-2 border border-gray-300 rounded">
                            <option value="000016.SH/上证50">000016.SH/上证50</option>
                            <option value="000300.SH/沪深300">000300.SH/沪深300</option>
                            <option value="000905.SH/中证500" selected>000905.SH/中证500</option>
                            <option value="000852.SH/中证1000">000852.SH/中证1000</option>
                            <option value="custom">自定义</option>
                        </select>
                        <div id="sharkfin-customUnderlying-container" class="mt-2 hidden">
                            <input type="text" id="sharkfin-customUnderlying" placeholder="请输入自定义挂钩标的（例如：000001.SH/上证指数）" class="w-full p-2 border border-gray-300 rounded">
                        </div>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">期限</label>
                        <select id="sharkfin-term" class="w-full p-2 border border-gray-300 rounded">
                            <option value="3M">3个月(3M)</option>
                            <option value="6M">6个月(6M)</option>
                            <option value="custom">自定义</option>
                        </select>
                        <div id="sharkfin-customTerm-container" class="mt-2 hidden">
                            <input type="text" id="sharkfin-customTerm" placeholder="请输入自定义期限（例如：12个月(1Y)）" class="w-full p-2 border border-gray-300 rounded">
                        </div>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">障碍价（期初价%）</label>
                        <input type="number" step="0.01" id="sharkfin-knockOutPrice" value="106.00" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">最低收益率（年化%）</label>
                        <input type="number" step="0.01" id="sharkfin-fixedRate" value="1.00" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">敲出收益率（年化%）</label>
                        <input type="number" step="0.01" id="sharkfin-knockOutRate" value="1.00" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">区间参与率（%）</label>
                        <input type="number" step="0.01" id="sharkfin-participation" value="115.00" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">最高收益率（年化%）</label>
                        <input type="number" step="0.01" id="sharkfin-maxRate" value="7.90" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">认购起点</label>
                        <input type="text" id="sharkfin-subscription" value="单笔5万元起认购，1万元追加" class="w-full p-2 border border-gray-300 rounded">
                    </div>

                </div>
                <div class="mt-4 flex gap-3">
                    <button onclick="App.generateSharkfinProduct()" class="bg-[#004aad] text-white px-4 py-2 rounded-lg hover:bg-[#003d7a] transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">生成产品介绍</button>
                    <button onclick="App.resetSharkfinForm()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">重置</button>
                    <!-- 导出PPT按钮 -->
                    <button onclick="App.exportSharkfinToPPT()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                        <span id="sharkfin-exportBtnText">导出PPT</span>
                        <span id="sharkfin-exportLoading" class="loading hidden"></span>
                    </button>
                </div>
            </div>

            <!-- 产品介绍区域 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- 左侧产品信息 -->
                <div>
                    <h2 class="text-2xl font-bold mb-4 text-[#004aad]">鲨鱼鳍结构（每日敲出观察）</h2>
                    <div class="border border-gray-300 rounded-lg overflow-hidden">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="table-header">
                                    <th class="p-2 text-left">凭证系列</th>
                                    <th class="p-2 text-left">跃享系列</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">认购起点</td>
                                    <td class="p-2" id="sharkfin-infoSubscription">单笔5万元起认购，1万元追加</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">挂钩标的名称（代码）</td>
                                    <td class="p-2" id="sharkfin-infoUnderlying">000905.SH/中证500</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">期限</td>
                                    <td class="p-2" id="sharkfin-infoTerm">3个月(3M)</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">障碍价（敲出价）</td>
                                    <td class="p-2" id="sharkfin-infoKnockOutPrice">期初价的106.00%</td>
                                </tr>
                                <tr class="border-b border-gray-200 bg-[#f0f7ff]">
                                    <td class="p-2 font-medium">结构方向</td>
                                    <td class="p-2 font-medium text-[#004aad]" id="sharkfin-infoDirection">看涨鲨鱼鳍</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">区间参与率</td>
                                    <td class="p-2" id="sharkfin-infoParticipation">115.00%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">收益情况</td>
                                    <td class="p-2" id="sharkfin-infoReturn">
                                        <!-- 收益情况将通过JS动态生成 -->
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="p-3 bg-gray-50 border-t border-gray-200">
                            <p><span class="font-medium">基本观点：</span>关注本金安全，对标的的走势与涨跌有预期</p>
                            <p class="mt-2 text-sm text-gray-600"><span class="font-medium">风险提示：</span>本产品为结构性产品，收益取决于挂钩标的表现，存在收益波动风险，请根据自身风险承受能力谨慎投资。</p>
                        </div>
                    </div>
                </div>

                <!-- 右侧损益图区域 -->
                <div>
                    <h2 class="text-xl font-bold mb-4">
                        <span class="chart-title">损益图</span>
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- 看涨敲出 -->
                        <div class="relative" id="sharkfin-bullKnockOutContainer">
                            <h3 class="text-base font-semibold mb-2 text-[#004aad]">敲出情形</h3>
                            <div class="direction-label" id="sharkfin-bullLabel">看涨</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="sharkfin-bullKnockOutChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- 看涨未敲出 -->
                        <div class="relative" id="sharkfin-bullNoKnockOutContainer">
                            <h3 class="text-base font-semibold mb-2 text-[#004aad]">未敲出情形</h3>
                            <div class="direction-label" id="sharkfin-bullNoKnockOutLabel">看涨</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="sharkfin-bullNoKnockOutChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- 看跌敲出 -->
                        <div class="relative" id="sharkfin-bearKnockOutContainer">
                            <h3 class="text-base font-semibold mb-2 text-[#004aad]">敲出情形</h3>
                            <div class="direction-label" id="sharkfin-bearLabel">看跌</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="sharkfin-bearKnockOutChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- 看跌未敲出 -->
                        <div class="relative" id="sharkfin-bearNoKnockOutContainer">
                            <h3 class="text-base font-semibold mb-2 text-[#004aad]">未敲出情形</h3>
                            <div class="direction-label" id="sharkfin-bearNoKnockOutLabel">看跌</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="sharkfin-bearNoKnockOutChart"></canvas>
                            </div>
                        </div>
                    </div>


                    <!-- 报价核心要素参考 -->
                    <div class="mt-6">
                        <h3 class="text-lg font-bold mb-2">报价核心要素参考：</h3>
                        <table class="min-w-full border border-gray-200 rounded-lg shadow-sm reference-table">
                            <thead>
                                <tr class="bg-[#004aad] text-white">
                                    <th class="p-2 border border-gray-300">序号</th>
                                    <th class="p-2 border border-gray-300">挂钩标的</th>
                                    <th class="p-2 border border-gray-300">方向</th>
                                    <th class="p-2 border border-gray-300">期限</th>
                                    <th class="p-2 border border-gray-300">固定收益率（年化）</th>
                                    <th class="p-2 border border-gray-300">区间参与率</th>
                                    <th class="p-2 border border-gray-300">敲出价格</th>
                                    <th class="p-2 border border-gray-300">敲出收益率（年化）</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="text-center">
                                    <td class="p-2 border border-gray-300">1</td>
                                    <td class="p-2 border border-gray-300">沪深300</td>
                                    <td class="p-2 border border-gray-300">看涨</td>
                                    <td class="p-2 border border-gray-300">6M</td>
                                    <td class="p-2 border border-gray-300">0.1%</td>
                                    <td class="p-2 border border-gray-300">50%</td>
                                    <td class="p-2 border border-gray-300">102%S₀</td>
                                    <td class="p-2 border border-gray-300">5.0%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 二元结构内容 -->
        <div id="binary-content" class="tab-content">
            <!-- 输入区域 -->
            <div class="mb-8 p-5 border border-gray-200 rounded-xl shadow-sm">
                <h2 class="text-xl font-bold mb-4">报价要素输入</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block mb-1 font-medium">产品方向</label>
                        <select id="binary-productDirection" class="w-full p-2 border border-gray-300 rounded">
                            <option value="bull">看涨二元</option>
                            <option value="bear">看跌二元</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">挂钩标的</label>
                        <select id="binary-underlying" class="w-full p-2 border border-gray-300 rounded">
                            <option value="000016.SH/上证50">000016.SH/上证50</option>
                            <option value="000300.SH/沪深300" selected>000300.SH/沪深300</option>
                            <option value="000905.SH/中证500">000905.SH/中证500</option>
                            <option value="000852.SH/中证1000">000852.SH/中证1000</option>
                            <option value="custom">自定义</option>
                        </select>
                        <div id="binary-customUnderlying-container" class="mt-2 hidden">
                            <input type="text" id="binary-customUnderlying" placeholder="请输入自定义挂钩标的（例如：000001.SH/上证指数）" class="w-full p-2 border border-gray-300 rounded">
                        </div>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">期限</label>
                        <select id="binary-term" class="w-full p-2 border border-gray-300 rounded">
                            <option value="3M">3个月(3M)</option>
                            <option value="6M">6个月(6M)</option>
                            <option value="custom">自定义</option>
                        </select>
                        <div id="binary-customTerm-container" class="mt-2 hidden">
                            <input type="text" id="binary-customTerm" placeholder="请输入自定义期限（例如：12个月(1Y)）" class="w-full p-2 border border-gray-300 rounded">
                        </div>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">行权价（期初价%）</label>
                        <input type="number" step="0.01" id="binary-strikePrice" value="102.00" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">最低收益率（年化%）</label>
                        <input type="number" step="0.01" id="binary-fixedRate" value="2.10" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">二元收益率（年化%）</label>
                        <input type="number" step="0.01" id="binary-binaryRate" value="3.60" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">认购起点</label>
                        <input type="text" id="binary-subscription" value="单笔5万元起认购，1万元追加" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                </div>
                <div class="mt-4 flex gap-3">
                    <button onclick="App.generateBinaryProduct()" class="bg-[#004aad] text-white px-4 py-2 rounded-lg hover:bg-[#003d7a] transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">生成产品介绍</button>
                    <button onclick="App.resetBinaryForm()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">重置</button>
                    <!-- 导出PPT按钮 -->
                    <button onclick="App.exportBinaryToPPT()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                        <span id="binary-exportBtnText">导出PPT</span>
                        <span id="binary-exportLoading" class="loading hidden"></span>
                    </button>
                </div>
            </div>

            <!-- 产品介绍区域 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- 左侧产品信息 -->
                <div>
                    <h2 class="text-2xl font-bold mb-4 text-[#004aad]">二元结构</h2>
                    <div class="border border-gray-300 rounded-lg overflow-hidden">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="table-header">
                                    <th class="p-2 text-left">凭证系列</th>
                                    <th class="p-2 text-left">跃享系列</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">认购起点</td>
                                    <td class="p-2" id="binary-infoSubscription">单笔5万元起认购，1万元追加</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">挂钩标的名称（代码）</td>
                                    <td class="p-2" id="binary-infoUnderlying">000300.SH/沪深300</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">期限</td>
                                    <td class="p-2" id="binary-infoTerm">3个月(3M)</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">行权价</td>
                                    <td class="p-2" id="binary-infoStrikePrice">期初价的102.00%</td>
                                </tr>
                                <tr class="border-b border-gray-200 bg-[#f0f7ff]">
                                    <td class="p-2 font-medium">结构方向</td>
                                    <td class="p-2 font-medium text-[#004aad]" id="binary-infoDirection">看涨二元</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">固定收益率（年化）</td>
                                    <td class="p-2" id="binary-infoFixedRate">2.10%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">二元收益率（年化）</td>
                                    <td class="p-2" id="binary-infoBinaryRate">3.60%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">收益情况</td>
                                    <td class="p-2" id="binary-infoReturn">
                                        <!-- 收益情况将通过JS动态生成 -->
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="p-3 bg-gray-50 border-t border-gray-200">
                            <p><span class="font-medium">基本观点：</span>关注本金安全，对标的的走势有明确方向预期</p>
                            <p class="mt-2 text-sm text-gray-600"><span class="font-medium">风险提示：</span>本产品为结构性产品，收益取决于挂钩标的表现，存在收益波动风险，请根据自身风险承受能力谨慎投资。</p>
                        </div>
                    </div>
                </div>

                <!-- 右侧损益图区域 -->
                <div>
                    <h2 class="text-xl font-bold mb-4">
                        <span class="chart-title">损益图</span>
                    </h2>
                    <div class="grid grid-cols-1 gap-6">
                        <!-- 看涨二元 -->
                        <div class="relative" id="binary-bullContainer">
                            <div class="direction-label" id="binary-bullLabel">看涨</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="binary-bullChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- 看跌二元 -->
                        <div class="relative" id="binary-bearContainer">
                            <div class="direction-label" id="binary-bearLabel">看跌</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="binary-bearChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <!-- 报价核心要素参考 -->
                    <div class="mt-6">
                        <h3 class="text-lg font-bold mb-2">报价核心要素参考：</h3>
                        <table class="min-w-full border border-gray-200 rounded-lg shadow-sm reference-table">
                            <thead>
                                <tr class="bg-[#004aad] text-white">
                                    <th class="p-2 border border-gray-300">序号</th>
                                    <th class="p-2 border border-gray-300">挂钩标的</th>
                                    <th class="p-2 border border-gray-300">方向</th>
                                    <th class="p-2 border border-gray-300">期限</th>
                                    <th class="p-2 border border-gray-300">固定收益率（年化）</th>
                                    <th class="p-2 border border-gray-300">敲出价格</th>
                                    <th class="p-2 border border-gray-300">二元收益率（年化）</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="text-center">
                                    <td class="p-2 border border-gray-300">1</td>
                                    <td class="p-2 border border-gray-300">沪深300</td>
                                    <td class="p-2 border border-gray-300">看涨</td>
                                    <td class="p-2 border border-gray-300">6M</td>
                                    <td class="p-2 border border-gray-300">2.10%</td>
                                    <td class="p-2 border border-gray-300">102%S₀</td>
                                    <td class="p-2 border border-gray-300">3.60%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 价差结构内容 -->
        <div id="spread-content" class="tab-content">
            <!-- 输入区域 -->
            <div class="mb-8 p-5 border border-gray-200 rounded-xl shadow-sm">
                <h2 class="text-xl font-bold mb-4">报价要素输入</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block mb-1 font-medium">产品方向</label>
                        <select id="spread-productDirection" class="w-full p-2 border border-gray-300 rounded">
                            <option value="bull">看涨价差</option>
                            <option value="bear">看跌价差</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">挂钩标的</label>
                        <select id="spread-underlying" class="w-full p-2 border border-gray-300 rounded">
                            <option value="000016.SH/上证50">000016.SH/上证50</option>
                            <option value="000300.SH/沪深300">000300.SH/沪深300</option>
                            <option value="000905.SH/中证500">000905.SH/中证500</option>
                            <option value="000852.SH/中证1000">000852.SH/中证1000</option>
                            <option value="N225.GI/日经225指数" selected>N225.GI/日经225指数</option>
                            <option value="custom">自定义</option>
                        </select>
                        <div id="spread-customUnderlying-container" class="mt-2 hidden">
                            <input type="text" id="spread-customUnderlying" placeholder="请输入自定义挂钩标的（例如：000001.SH/上证指数）" class="w-full p-2 border border-gray-300 rounded">
                        </div>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">期限</label>
                        <select id="spread-term" class="w-full p-2 border border-gray-300 rounded">
                            <option value="3M">3个月(3M)</option>
                            <option value="6M">6个月(6M)</option>
                            <option value="custom">自定义</option>
                        </select>
                        <div id="spread-customTerm-container" class="mt-2 hidden">
                            <input type="text" id="spread-customTerm" placeholder="请输入自定义期限（例如：18个月(1.5Y)）" class="w-full p-2 border border-gray-300 rounded">
                        </div>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">行权价（期初价%）</label>
                        <input type="number" step="0.01" id="spread-strikePrice" value="106.00" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">固定收益率（年化%）</label>
                        <input type="number" step="0.01" id="spread-fixedRate" value="0.10" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">参与率（%）</label>
                        <input type="number" step="0.01" id="spread-participation" value="70.00" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">最高收益率（年化%）</label>
                        <input type="number" step="0.01" id="spread-maxRate" value="4.30" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">敲出收益率（年化%）</label>
                        <input type="number" step="0.01" id="spread-knockOutRate" value="0.10" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">认购起点</label>
                        <input type="text" id="spread-subscription" value="单笔5万元起认购，1万元追加" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                </div>
                <div class="mt-4 flex gap-3">
                    <button onclick="App.generateSpreadProduct()" class="bg-[#004aad] text-white px-4 py-2 rounded-lg hover:bg-[#003d7a] transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">生成产品介绍</button>
                    <button onclick="App.resetSpreadForm()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">重置</button>
                    <!-- 导出PPT按钮 -->
                    <button onclick="App.exportSpreadToPPT()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                        <span id="spread-exportBtnText">导出PPT</span>
                        <span id="spread-exportLoading" class="loading hidden"></span>
                    </button>
                </div>
            </div>

            <!-- 产品介绍区域 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- 左侧产品信息 -->
                <div>
                    <h2 class="text-2xl font-bold mb-4 text-[#004aad]">价差结构</h2>
                    <div class="border border-gray-300 rounded-lg overflow-hidden">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="table-header">
                                    <th class="p-2 text-left">凭证系列</th>
                                    <th class="p-2 text-left">跃享系列</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">认购起点</td>
                                    <td class="p-2" id="spread-infoSubscription">单笔5万元起认购，1万元追加</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">挂钩标的名称（代码）</td>
                                    <td class="p-2" id="spread-infoUnderlying">N225.GI/日经225指数</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">期限</td>
                                    <td class="p-2" id="spread-infoTerm">3个月(3M)</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">行权价</td>
                                    <td class="p-2" id="spread-infoStrikePrice">期初价的106.00%</td>
                                </tr>
                                <tr class="border-b border-gray-200 bg-[#f0f7ff]">
                                    <td class="p-2 font-medium">结构方向</td>
                                    <td class="p-2 font-medium text-[#004aad]" id="spread-infoDirection">看涨价差</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">固定收益率（年化）</td>
                                    <td class="p-2" id="spread-infoFixedRate">0.10%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">参与率</td>
                                    <td class="p-2" id="spread-infoParticipation">70.00%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">最高收益率（年化）</td>
                                    <td class="p-2" id="spread-infoMaxRate">4.30%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">敲出收益率（年化）</td>
                                    <td class="p-2" id="spread-infoKnockOutRate">0.10%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">收益情况</td>
                                    <td class="p-2" id="spread-infoReturn">
                                        <!-- 收益情况将通过JS动态生成 -->
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="p-3 bg-gray-50 border-t border-gray-200">
                            <p><span class="font-medium">基本观点：</span>关注本金安全，对标的的走势有明确方向预期</p>
                            <p class="mt-2 text-sm text-gray-600"><span class="font-medium">风险提示：</span>本产品为结构性产品，收益取决于挂钩标的表现，存在收益波动风险，请根据自身风险承受能力谨慎投资。</p>
                        </div>
                    </div>
                </div>

                <!-- 右侧损益图区域 -->
                <div>
                    <h2 class="text-xl font-bold mb-4">
                        <span class="chart-title">损益图</span>
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- 看涨价差 -->
                        <div class="relative" id="spread-bullContainer">
                            <h3 class="text-base font-semibold mb-2 text-[#004aad]">看涨价差</h3>
                            <div class="direction-label" id="spread-bullLabel">看涨</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="spread-bullChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- 看跌价差 -->
                        <div class="relative" id="spread-bearContainer">
                            <h3 class="text-base font-semibold mb-2 text-[#004aad]">看跌价差</h3>
                            <div class="direction-label" id="spread-bearLabel">看跌</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="spread-bearChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <!-- 报价核心要素参考 -->
                    <div class="mt-6">
                        <h3 class="text-lg font-bold mb-2">报价核心要素参考：</h3>
                        <table class="min-w-full border border-gray-200 rounded-lg shadow-sm reference-table">
                            <thead>
                                <tr class="bg-[#004aad] text-white">
                                    <th class="p-2 border border-gray-300">序号</th>
                                    <th class="p-2 border border-gray-300">挂钩标的</th>
                                    <th class="p-2 border border-gray-300">方向</th>
                                    <th class="p-2 border border-gray-300">期限</th>
                                    <th class="p-2 border border-gray-300">固定收益率（年化）</th>
                                    <th class="p-2 border border-gray-300">区间参与率</th>
                                    <th class="p-2 border border-gray-300">障碍价</th>
                                    <th class="p-2 border border-gray-300">最高收益率（年化）</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="text-center">
                                    <td class="p-2 border border-gray-300">1</td>
                                    <td class="p-2 border border-gray-300">日经225指数</td>
                                    <td class="p-2 border border-gray-300">看涨</td>
                                    <td class="p-2 border border-gray-300">6M</td>
                                    <td class="p-2 border border-gray-300">0.1%</td>
                                    <td class="p-2 border border-gray-300">50%</td>
                                    <td class="p-2 border border-gray-300">102%S₀</td>
                                    <td class="p-2 border border-gray-300">5.0%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 香草结构内容 -->
        <div id="vanilla-content" class="tab-content">
            <!-- 输入区域 -->
            <div class="mb-8 p-5 border border-gray-200 rounded-xl shadow-sm">
                <h2 class="text-xl font-bold mb-4">报价要素输入</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block mb-1 font-medium">产品方向</label>
                        <select id="vanilla-productDirection" class="w-full p-2 border border-gray-300 rounded">
                            <option value="bull">看涨香草</option>
                            <option value="bear">看跌香草</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">挂钩标的</label>
                        <select id="vanilla-underlying" class="w-full p-2 border border-gray-300 rounded">
                            <option value="000016.SH/上证50">000016.SH/上证50</option>
                            <option value="000300.SH/沪深300">000300.SH/沪深300</option>
                            <option value="000905.SH/中证500">000905.SH/中证500</option>
                            <option value="000852.SH/中证1000">000852.SH/中证1000</option>
                            <option value="931995.CSI/中证国泰海通大类动态配置指数" selected>931995.CSI/中证国泰海通大类动态配置指数</option>
                            <option value="custom">自定义</option>
                        </select>
                        <div id="vanilla-customUnderlying-container" class="mt-2 hidden">
                            <input type="text" id="vanilla-customUnderlying" placeholder="请输入自定义挂钩标的（例如：000001.SH/上证指数）" class="w-full p-2 border border-gray-300 rounded">
                        </div>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">期限</label>
                        <select id="vanilla-term" class="w-full p-2 border border-gray-300 rounded">
                            <option value="3M">3个月(3M)</option>
                            <option value="6M">6个月(6M)</option>
                            <option value="custom">自定义</option>
                        </select>
                        <div id="vanilla-customTerm-container" class="mt-2 hidden">
                            <input type="text" id="vanilla-customTerm" placeholder="请输入自定义期限（例如：18个月(1.5Y)）" class="w-full p-2 border border-gray-300 rounded">
                        </div>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">参与率（%）</label>
                        <input type="number" step="0.01" id="vanilla-participation" value="50.00" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">最低收益率（年化%）</label>
                        <input type="number" step="0.01" id="vanilla-fixedRate" value="0.00" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">认购起点</label>
                        <input type="text" id="vanilla-subscription" value="单笔5万元起认购，1万元追加" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                </div>
                <div class="mt-4 flex gap-3">
                    <button onclick="App.generateVanillaProduct()" class="bg-[#004aad] text-white px-4 py-2 rounded-lg hover:bg-[#003d7a] transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">生成产品介绍</button>
                    <button onclick="App.resetVanillaForm()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">重置</button>
                    <!-- 导出PPT按钮 -->
                    <button onclick="App.exportVanillaToPPT()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                        <span id="vanilla-exportBtnText">导出PPT</span>
                        <span id="vanilla-exportLoading" class="loading hidden"></span>
                    </button>
                </div>
            </div>

            <!-- 产品介绍区域 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- 左侧产品信息 -->
                <div>
                    <h2 class="text-2xl font-bold mb-4 text-[#004aad]">香草结构</h2>
                    <div class="border border-gray-300 rounded-lg overflow-hidden">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="table-header">
                                    <th class="p-2 text-left">凭证系列</th>
                                    <th class="p-2 text-left">跃享系列</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">认购起点</td>
                                    <td class="p-2" id="vanilla-infoSubscription">单笔5万元起认购，1万元追加</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">挂钩标的名称（代码）</td>
                                    <td class="p-2" id="vanilla-infoUnderlying">931995.CSI/中证国泰海通大类动态配置指数</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">期限</td>
                                    <td class="p-2" id="vanilla-infoTerm">3个月(3M)</td>
                                </tr>
                                <tr class="border-b border-gray-200 bg-[#f0f7ff]">
                                    <td class="p-2 font-medium">结构方向</td>
                                    <td class="p-2 font-medium text-[#004aad]" id="vanilla-infoDirection">看涨香草</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">参与率</td>
                                    <td class="p-2" id="vanilla-infoParticipation">50.00%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">最低收益率（年化）</td>
                                    <td class="p-2" id="vanilla-infoFixedRate">0.00%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">收益情况</td>
                                    <td class="p-2" id="vanilla-infoReturn">
                                        <!-- 收益情况将通过JS动态生成 -->
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="p-3 bg-gray-50 border-t border-gray-200">
                            <p><span class="font-medium">基本观点：</span>关注本金安全，对标的的走势有明确方向预期</p>
                            <p class="mt-2 text-sm text-gray-600"><span class="font-medium">风险提示：</span>本产品为结构性产品，收益取决于挂钩标的表现，存在收益波动风险，请根据自身风险承受能力谨慎投资。</p>
                        </div>
                    </div>
                </div>

                <!-- 右侧损益图区域 -->
                <div>
                    <h2 class="text-xl font-bold mb-4">
                        <span class="chart-title">损益图</span>
                    </h2>
                    <div class="grid grid-cols-1 gap-6">
                        <!-- 看涨香草 -->
                        <div class="relative" id="vanilla-bullContainer">
                            <div class="direction-label" id="vanilla-bullLabel">看涨</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="vanilla-bullChart"></canvas>
                            </div>

                        </div>
                    <!-- 看跌香草 -->
                    <div class="relative" id="vanilla-bearContainer">
                        <div class="direction-label" id="vanilla-bearLabel">看跌</div>
                        <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                            <canvas id="vanilla-bearChart"></canvas>
                        </div>
                    </div>
                    <!-- 报价核心要素参考 -->
                    <div class="mt-6">
                        <h3 class="text-lg font-bold mb-2">报价核心要素参考：</h3>
                        <table class="min-w-full border border-gray-200 rounded-lg shadow-sm reference-table">
                            <thead>
                                <tr class="bg-[#004aad] text-white">
                                    <th class="p-2 border border-gray-300">序号</th>
                                    <th class="p-2 border border-gray-300">挂钩标的</th>
                                    <th class="p-2 border border-gray-300">方向</th>
                                    <th class="p-2 border border-gray-300">期限</th>
                                    <th class="p-2 border border-gray-300">固定收益率（年化）</th>
                                    <th class="p-2 border border-gray-300">区间参与率</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="text-center">
                                    <td class="p-2 border border-gray-300">1</td>
                                    <td class="p-2 border border-gray-300">日经225指数</td>
                                    <td class="p-2 border border-gray-300">看涨</td>
                                    <td class="p-2 border border-gray-300">6M</td>
                                    <td class="p-2 border border-gray-300">0.1%</td>
                                    <td class="p-2 border border-gray-300">50%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            </div>
        </div>

        <!-- 自动赎回结构内容 -->
        <div id="autocall-content" class="tab-content">
            <!-- 输入区域 -->
            <div class="mb-8 p-5 border border-gray-200 rounded-xl shadow-sm">
                <h2 class="text-xl font-bold mb-4">报价要素输入</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block mb-1 font-medium">产品方向</label>
                        <select id="autocall-productDirection" class="w-full p-2 border border-gray-300 rounded" onchange="App.generateAutocallProduct()">
                            <option value="bull">看涨自动赎回</option>
                            <option value="bear">看跌自动赎回</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">挂钩标的</label>
                        <select id="autocall-underlying" class="w-full p-2 border border-gray-300 rounded">
                            <option value="000016.SH/上证50">000016.SH/上证50</option>
                            <option value="000300.SH/沪深300">000300.SH/沪深300</option>
                            <option value="000905.SH/中证500" selected>000905.SH/中证500</option>
                            <option value="000852.SH/中证1000">000852.SH/中证1000</option>
                            <option value="custom">自定义</option>
                        </select>
                        <div id="autocall-customUnderlying-container" class="mt-2 hidden">
                            <input type="text" id="autocall-customUnderlying" placeholder="请输入自定义挂钩标的（例如：000001.SH/上证指数）" class="w-full p-2 border border-gray-300 rounded">
                        </div>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">期限</label>
                        <select id="autocall-term" class="w-full p-2 border border-gray-300 rounded">
                            <option value="3M">3个月(3M)</option>
                            <option value="6M">6个月(6M)</option>
                            <option value="1Y">1年(1Y)</option>
                            <option value="custom">自定义</option>
                        </select>
                        <div id="autocall-customTerm-container" class="mt-2 hidden">
                            <input type="text" id="autocall-customTerm" placeholder="请输入自定义期限（例如：18个月(1.5Y)）" class="w-full p-2 border border-gray-300 rounded">
                        </div>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">敲出观察频率</label>
                        <select id="autocall-observationFrequency" class="w-full p-2 border border-gray-300 rounded">
                            <option value="monthly">月度</option>
                            <option value="weekly">周度</option>
                            <option value="daily">每日</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">敲出价格（期初价格%）</label>
                        <input type="number" step="0.01" id="autocall-knockOutPrice" value="102.00" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">敲出收益率（年化%）</label>
                        <input type="number" step="0.01" id="autocall-knockOutRate" value="5.00" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">最低收益率（年化%）</label>
                        <input type="number" step="0.01" id="autocall-fixedRate" value="0.10" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium">认购起点</label>
                        <input type="text" id="autocall-subscription" value="单笔5万元起认购，1万元追加" class="w-full p-2 border border-gray-300 rounded">
                    </div>
                </div>
                <div class="mt-4 flex gap-3">
                    <button onclick="App.generateAutocallProduct()" class="bg-[#004aad] text-white px-4 py-2 rounded-lg hover:bg-[#003d7a] transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">生成产品介绍</button>
                    <button onclick="App.resetAutocallForm()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">重置</button>
                    <!-- 导出PPT按钮 -->
                    <button onclick="App.exportAutocallToPPT()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                        <span id="autocall-exportBtnText">导出PPT</span>
                        <span id="autocall-exportLoading" class="loading hidden"></span>
                    </button>
                </div>
            </div>

            <!-- 产品介绍区域 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- 左侧产品信息 -->
                <div>
                    <h2 class="text-2xl font-bold mb-4 text-[#004aad]">自动赎回结构</h2>
                    <div class="border border-gray-300 rounded-lg overflow-hidden">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="table-header">
                                    <th class="p-2 text-left">凭证系列</th>
                                    <th class="p-2 text-left">凤玺系列</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">认购起点</td>
                                    <td class="p-2" id="autocall-infoSubscription">单笔5万元起认购，1万元追加</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">挂钩标的名称（代码）</td>
                                    <td class="p-2" id="autocall-infoUnderlying">000905.SH/中证500</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">期限</td>
                                    <td class="p-2" id="autocall-infoTerm">6个月(6M)</td>
                                </tr>
                                <tr class="border-b border-gray-200 bg-[#f0f7ff]">
                                    <td class="p-2 font-medium">结构方向</td>
                                    <td class="p-2 font-medium text-[#004aad]" id="autocall-infoDirection">看涨自动赎回</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">敲出观察频率</td>
                                    <td class="p-2" id="autocall-infoObservationFrequency">每月定期敲出观察</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">敲出价格</td>
                                    <td class="p-2" id="autocall-infoKnockOutPrice">102.00%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">敲出收益率（年化）</td>
                                    <td class="p-2" id="autocall-infoKnockOutRate">5.00%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">最低收益率（年化）</td>
                                    <td class="p-2" id="autocall-infoFixedRate">0.10%</td>
                                </tr>
                                <tr class="border-b border-gray-200">
                                    <td class="p-2 font-medium">收益情况</td>
                                    <td class="p-2" id="autocall-infoReturn">
                                        <!-- 收益情况将通过JS动态生成 -->
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="p-3 bg-gray-50 border-t border-gray-200">
                            <p><span class="font-medium">基本观点：</span>关注本金安全，对标的的走势有明确方向预期</p>
                            <p class="mt-2 text-sm text-gray-600"><span class="font-medium">风险提示：</span>本产品为结构性产品，收益取决于挂钩标的表现，存在收益波动风险，请根据自身风险承受能力谨慎投资。</p>
                        </div>
                    </div>
                </div>

                <!-- 右侧损益图区域 -->
                <div>
                    <h2 class="text-xl font-bold mb-4">
                        <span class="chart-title">损益图</span>
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- 看涨自动赎回 - 敲出情形 -->
                        <div class="relative" id="autocall-bull-knockoutContainer" style="display: block;">
                            <div class="direction-label" id="autocall-bull-knockoutLabel">看涨-敲出情形</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="autocall-bull-knockoutChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- 看涨自动赎回 - 未敲出情形 -->
                        <div class="relative" id="autocall-bull-nonknockoutContainer" style="display: block;">
                            <div class="direction-label" id="autocall-bull-nonknockoutLabel">看涨-未敲出情形</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="autocall-bull-nonknockoutChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- 看跌自动赎回 - 敲出情形 -->
                        <div class="relative" id="autocall-bear-knockoutContainer" style="display: none;">
                            <div class="direction-label" id="autocall-bear-knockoutLabel">看跌-敲出情形</div>
                            <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                                <canvas id="autocall-bear-knockoutChart"></canvas>
                            </div>
                        </div>
                    <!-- 看跌自动赎回 - 未敲出情形 -->
                    <div class="relative" id="autocall-bear-nonknockoutContainer" style="display: none;">
                        <div class="direction-label" id="autocall-bear-nonknockoutLabel">看跌-未敲出情形</div>
                        <div class="chart-container border border-gray-200 rounded-lg p-3 shadow-sm">
                            <canvas id="autocall-bear-nonknockoutChart"></canvas>
                        </div>
                    </div>
                </div>
                <!-- 报价核心要素参考 -->
                <div class="mt-6">
                    <h3 class="text-lg font-bold mb-2">报价核心要素参考：</h3>
                    <table class="min-w-full border border-gray-200 rounded-lg shadow-sm reference-table">
                        <thead>
                            <tr class="bg-[#004aad] text-white">
                                <th class="p-2 border border-gray-300">序号</th>
                                <th class="p-2 border border-gray-300">挂钩标的</th>
                                <th class="p-2 border border-gray-300">方向</th>
                                <th class="p-2 border border-gray-300">期限</th>
                                <th class="p-2 border border-gray-300">敲出价格</th>
                                <th class="p-2 border border-gray-300">固定收益率（年化）</th>
                                <th class="p-2 border border-gray-300">敲出收益率（年化）</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="text-center">
                                <td class="p-2 border border-gray-300">1</td>
                                <td class="p-2 border border-gray-300">中证500</td>
                                <td class="p-2 border border-gray-300">看涨</td>
                                <td class="p-2 border border-gray-300">6M</td>
                                <td class="p-2 border border-gray-300">102%S₀</td>
                                <td class="p-2 border border-gray-300">0.1%</td>
                                <td class="p-2 border border-gray-300">5.0%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        </div>
    
    <script>
        // 切换标签页
        function switchTab(tabName, event) {
            // 隐藏所有内容
            document.getElementById('sharkfin-content').classList.remove('active');
            document.getElementById('binary-content').classList.remove('active');
            document.getElementById('spread-content').classList.remove('active');
            document.getElementById('vanilla-content').classList.remove('active');
            document.getElementById('autocall-content').classList.remove('active');
            
            // 移除所有按钮的激活状态
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 显示选中的内容
            document.getElementById(tabName + '-content').classList.add('active');
            
            // 激活对应的按钮
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // 如果没有事件对象，通过标签名直接查找按钮
                document.querySelector(`[onclick="switchTab('${tabName}', event)"]`).classList.add('active');
            }
            
            // 切换标签后重新绘制当前结构的图表
            if (tabName === 'sharkfin') {
                App.generateSharkfinProduct();
            } else if (tabName === 'binary') {
                App.generateBinaryProduct();
            } else if (tabName === 'spread') {
                App.generateSpreadProduct();
            } else if (tabName === 'vanilla') {
                App.generateVanillaProduct();
            } else if (tabName === 'autocall') {
                App.generateAutocallProduct();
            }
        }

        // 图表管理模块
        const ChartManager = {
            charts: {},
            
            // 初始化图表容器的resize事件监听器
            initResizeListeners() {
                const chartContainers = document.querySelectorAll('.chart-container');
                chartContainers.forEach(container => {
                    // 添加resize事件监听器
                    container.addEventListener('resize', () => {
                        // 触发窗口resize事件，让Chart.js自动调整图表大小
                        window.dispatchEvent(new Event('resize'));
                        
                        // 找到对应的方向标签并触发重绘
                        const containerId = container.closest('.relative').id;
                        const label = document.querySelector(`#${containerId} .direction-label`);
                        if (label) {
                            // 强制重绘标签，确保位置正确
                            label.style.transform = 'none';
                            void label.offsetWidth; // 触发回流
                            label.style.transform = 'translateX(-50%)';
                        }
                    });
                });
            },
            
            // 获取基础图表配置
            getBaseOptions(xMin, xMax, maxY, customAnnotations = {}) {
                return {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: { 
                                display: true, 
                                text: '期末价格/期初价格',
                                font: { weight: 'bold' }
                            },
                            ticks: { 
                                callback: v => `${v}%`,
                                stepSize: 10
                            },
                            grid: { display: false },
                            border: { display: true },
                            min: xMin,
                            max: xMax,
                            z: 0
                        },
                        y: {
                            position: 'left',
                            title: { 
                                display: true, 
                                text: '到期年化收益率',
                                font: { weight: 'bold' }
                            },
                            ticks: { 
                                callback: v => `${v}%`,
                                stepSize: 1
                            },
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            border: { display: true },
                            min: 0,
                            max: maxY + 1,
                            z: 0
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { 
                            enabled: true,
                            callbacks: {
                                title: function(context) {
                                    return `价格: ${context[0].parsed.x}%`;
                                },
                                label: function(context) {
                                    return `收益率: ${context[0].parsed.y}%`;
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                // 纵轴（100%价格线）
                                strikeLine: {
                                    type: 'line',
                                    xMin: 100,
                                    xMax: 100,
                                    yMin: -5,
                                    yMax: maxY + 1,
                                    borderColor: '#000',
                                    borderWidth: 1.5,
                                    borderDash: []
                                },
                                ...customAnnotations
                            }
                        }
                    },
                    animation: { duration: 0 }
                };
            },
            
            // 绘制看涨-敲出情形图表（鲨鱼鳍）
            drawBullKnockOutChart(knockOutPrice, knockOutRate, maxY) {
                const xMin = Math.min(85, knockOutPrice - 10);
                const xMax = Math.max(115, knockOutPrice + 10);
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('sharkfin-bullKnockOutChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bullKnockOut) {
                    this.charts.bullKnockOut.destroy();
                }
                
                this.charts.bullKnockOut = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: [
                                {x: xMin, y: knockOutRate},
                                {x: xMax, y: knockOutRate}
                            ],
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY),
                        plugins: {
                            ...this.getBaseOptions(xMin, xMax, maxY).plugins,
                            annotation: {
                                annotations: {
                                    ...this.getBaseOptions(xMin, xMax, maxY).plugins.annotation.annotations,
                                    // 敲出收益率标签
                                    knockOutRateLabel: {
                                        type: 'label',
                                        content: `${knockOutRate}%`,
                                        xValue: xMax - 10,
                                        yValue: knockOutRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // 绘制看涨-未敲出情形图表（鲨鱼鳍）
            drawBullNoKnockOutChart(knockOutPrice, fixedRate, participation, maxRate) {
                const xMin = Math.min(85, knockOutPrice - 10);
                const xMax = Math.max(115, knockOutPrice + 10);
                const maxY = Math.max(fixedRate, maxRate);
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('sharkfin-bullNoKnockOutChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bullNoKnockOut) {
                    this.charts.bullNoKnockOut.destroy();
                }
                
                this.charts.bullNoKnockOut = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: [
                                {x: xMin, y: fixedRate},    // 左侧水平段
                                {x: 100, y: fixedRate},  // 转折点1
                                {x: knockOutPrice, y: maxRate}   // 转折点2（截止到障碍价）
                            ],
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY),
                        plugins: {
                            ...this.getBaseOptions(xMin, xMax, maxY).plugins,
                            annotation: {
                                annotations: {
                                    ...this.getBaseOptions(xMin, xMax, maxY).plugins.annotation.annotations,
                                    // 障碍价线
                                    knockOutLine: {
                                        type: 'line',
                                        xMin: knockOutPrice,
                                        xMax: knockOutPrice,
                                        yMin: 0,
                                        yMax: maxY,
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    },
                                    // 障碍价标签
                                    knockOutLabel: {
                                        type: 'label',
                                        content: `${knockOutPrice}%`,
                                        xValue: knockOutPrice,
                                        yValue: 0.5,
                                        backgroundColor: 'white',
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 最高收益标签
                                    maxRateLabel: {
                                        type: 'label',
                                        content: `${maxRate}%`,
                                        xValue: knockOutPrice - 2,
                                        yValue: maxRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 参与率标签
                                    participationLabel: {
                                        type: 'label',
                                        content: `区间参与率 ${participation}%`,
                                        xValue: 100 + ((knockOutPrice - 100) / 2),
                                        yValue: (fixedRate + maxRate) / 2,
                                        backgroundColor: 'white',
                                        borderColor: '#666',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 最低收益率标签（100%左边的横线）
                                    fixedRateLabel: {
                                        type: 'label',
                                        content: `${fixedRate}%`,
                                        xValue: xMin + 5,
                                        yValue: fixedRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // 绘制看跌-敲出情形图表（鲨鱼鳍）
            drawBearKnockOutChart(knockOutPrice, knockOutRate, maxY) {
                const xMin = Math.min(85, knockOutPrice - 10);
                const xMax = Math.max(115, knockOutPrice + 10);
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('sharkfin-bearKnockOutChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bearKnockOut) {
                    this.charts.bearKnockOut.destroy();
                }
                
                this.charts.bearKnockOut = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: [
                                {x: xMin, y: knockOutRate},
                                {x: xMax, y: knockOutRate}
                            ],
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY),
                        plugins: {
                            ...this.getBaseOptions(xMin, xMax, maxY).plugins,
                            annotation: {
                                annotations: {
                                    ...this.getBaseOptions(xMin, xMax, maxY).plugins.annotation.annotations,
                                    // 敲出收益率标签
                                    knockOutRateLabel: {
                                        type: 'label',
                                        content: `${knockOutRate}%`,
                                        xValue: xMax - 10,
                                        yValue: knockOutRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // 绘制看跌-未敲出情形图表（鲨鱼鳍）
            drawBearNoKnockOutChart(knockOutPrice, fixedRate, participation, maxRate) {
                const xMin = Math.min(85, knockOutPrice - 10);
                const xMax = Math.max(115, knockOutPrice + 10);
                const maxY = Math.max(fixedRate, maxRate);
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('sharkfin-bearNoKnockOutChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bearNoKnockOut) {
                    this.charts.bearNoKnockOut.destroy();
                }
                
                this.charts.bearNoKnockOut = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: [
                                {x: xMax, y: fixedRate},   // 右侧水平段（价格上涨，收益固定）
                                {x: 100, y: fixedRate},  // 转折点1（价格不变，收益固定）
                                {x: knockOutPrice, y: maxRate}   // 转折点2（价格下跌到障碍价，收益达到最高）
                            ],
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY),
                        plugins: {
                            ...this.getBaseOptions(xMin, xMax, maxY).plugins,
                            annotation: {
                                annotations: {
                                    ...this.getBaseOptions(xMin, xMax, maxY).plugins.annotation.annotations,
                                    // 障碍价线
                                    knockOutLine: {
                                        type: 'line',
                                        xMin: knockOutPrice,
                                        xMax: knockOutPrice,
                                        yMin: 0,
                                        yMax: maxY,
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    },
                                    // 障碍价标签
                                    knockOutLabel: {
                                        type: 'label',
                                        content: `${knockOutPrice}%`,
                                        xValue: knockOutPrice,
                                        yValue: 0.5,
                                        backgroundColor: 'white',
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 最高收益标签
                                    maxRateLabel: {
                                        type: 'label',
                                        content: `${maxRate}%`,
                                        xValue: knockOutPrice + 2,
                                        yValue: maxRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 参与率标签
                                    participationLabel: {
                                        type: 'label',
                                        content: `区间参与率 ${participation}%`,
                                        xValue: 100 - ((100 - knockOutPrice) / 2),
                                        yValue: (fixedRate + maxRate) / 2,
                                        backgroundColor: 'white',
                                        borderColor: '#666',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 最低收益率标签（100%右边的横线）
                                    fixedRateLabel: {
                                        type: 'label',
                                        content: `${fixedRate}%`,
                                        xValue: xMax - 5,
                                        yValue: fixedRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // 绘制看涨二元图表
            drawBullBinaryChart(strikePrice, fixedRate, binaryRate) {
                const xMin = Math.min(85, strikePrice - 10);
                const xMax = Math.max(115, strikePrice + 10);
                const maxY = Math.max(fixedRate, binaryRate);
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('binary-bullChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bullBinary) {
                    this.charts.bullBinary.destroy();
                }
                
                this.charts.bullBinary = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [
                            {
                                data: [
                                    {x: xMin, y: fixedRate},       // 左侧水平段（低于行权价，固定收益）
                                    {x: strikePrice, y: fixedRate} // 行权价左侧点
                                ],
                                borderColor: '#004aad',
                                borderWidth: 2,
                                pointRadius: 0,
                                fill: false,
                                tension: 0
                            },
                            {
                                data: [
                                    {x: strikePrice, y: binaryRate}, // 行权价右侧点（跳跃到二元收益）
                                    {x: xMax, y: binaryRate}        // 右侧水平段（高于行权价，二元收益）
                                ],
                                borderColor: '#004aad',
                                borderWidth: 2,
                                pointRadius: 0,
                                fill: false,
                                tension: 0
                            }
                        ]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY),
                        plugins: {
                            ...this.getBaseOptions(xMin, xMax, maxY).plugins,
                            annotation: {
                                annotations: {
                                    ...this.getBaseOptions(xMin, xMax, maxY).plugins.annotation.annotations,
                                    // 行权价线
                                    strikePriceLine: {
                                        type: 'line',
                                        xMin: strikePrice,
                                        xMax: strikePrice,
                                        yMin: 0,
                                        yMax: maxY,
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    },
                                    // 行权价标签
                                    strikePriceLabel: {
                                        type: 'label',
                                        content: `${strikePrice}%`,
                                        xValue: strikePrice,
                                        yValue: 0.5,
                                        backgroundColor: 'white',
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 固定收益率标签
                                    fixedRateLabel: {
                                        type: 'label',
                                        content: `${fixedRate}%`,
                                        xValue: xMin + 5,
                                        yValue: fixedRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    },
                                    // 二元收益率标签
                                    binaryRateLabel: {
                                        type: 'label',
                                        content: `${binaryRate}%`,
                                        xValue: xMax - 5,
                                        yValue: binaryRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // 绘制看跌二元图表
            drawBearBinaryChart(strikePrice, fixedRate, binaryRate) {
                const xMin = Math.min(85, strikePrice - 10);
                const xMax = Math.max(115, strikePrice + 10);
                const maxY = Math.max(fixedRate, binaryRate);
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('binary-bearChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bearBinary) {
                    this.charts.bearBinary.destroy();
                }
                
                this.charts.bearBinary = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [
                            {
                                data: [
                                    {x: xMin, y: binaryRate},       // 左侧水平段（低于行权价，二元收益）
                                    {x: strikePrice, y: binaryRate} // 行权价左侧点
                                ],
                                borderColor: '#004aad',
                                borderWidth: 2,
                                pointRadius: 0,
                                fill: false,
                                tension: 0
                            },
                            {
                                data: [
                                    {x: strikePrice, y: fixedRate}, // 行权价右侧点（跳跃到固定收益）
                                    {x: xMax, y: fixedRate}        // 右侧水平段（高于行权价，固定收益）
                                ],
                                borderColor: '#004aad',
                                borderWidth: 2,
                                pointRadius: 0,
                                fill: false,
                                tension: 0
                            }
                        ]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY),
                        plugins: {
                            ...this.getBaseOptions(xMin, xMax, maxY).plugins,
                            annotation: {
                                annotations: {
                                    ...this.getBaseOptions(xMin, xMax, maxY).plugins.annotation.annotations,
                                    // 行权价线
                                    strikePriceLine: {
                                        type: 'line',
                                        xMin: strikePrice,
                                        xMax: strikePrice,
                                        yMin: 0,
                                        yMax: maxY,
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    },
                                    // 行权价标签
                                    strikePriceLabel: {
                                        type: 'label',
                                        content: `${strikePrice}%`,
                                        xValue: strikePrice,
                                        yValue: 0.5,
                                        backgroundColor: 'white',
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 二元收益率标签
                                    binaryRateLabel: {
                                        type: 'label',
                                        content: `${binaryRate}%`,
                                        xValue: xMin + 5,
                                        yValue: binaryRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    },
                                    // 固定收益率标签
                                    fixedRateLabel: {
                                        type: 'label',
                                        content: `${fixedRate}%`,
                                        xValue: xMax - 5,
                                        yValue: fixedRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // 绘制所有鲨鱼鳍图表
            drawSharkfinCharts(isBull, knockOutPrice, fixedRate, knockOutRate, participation, maxRate) {
                const maxY = Math.max(Math.max(fixedRate, knockOutRate), maxRate);
                
                // 绘制所有情况的图表
                this.drawBullKnockOutChart(knockOutPrice, knockOutRate, maxY);
                this.drawBullNoKnockOutChart(knockOutPrice, fixedRate, participation, maxRate);
                this.drawBearKnockOutChart(knockOutPrice, knockOutRate, maxY);
                this.drawBearNoKnockOutChart(knockOutPrice, fixedRate, participation, maxRate);
            },
            
            // 绘制所有二元图表
            drawBinaryCharts(isBull, strikePrice, fixedRate, binaryRate) {
                // 绘制两种情况的图表
                this.drawBullBinaryChart(strikePrice, fixedRate, binaryRate);
                this.drawBearBinaryChart(strikePrice, fixedRate, binaryRate);
            },
            
            // 绘制看涨香草图表
            drawBullVanillaChart(participation, fixedRate) {
                const xMin = 80;
                const xMax = 120;
                const maxY = Math.max(fixedRate, participation * 0.2) + 1; // 考虑20%涨幅情况
                
                // 确保Canvas元素存在且Chart对象可用
                const canvas = document.getElementById('vanilla-bullChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bullVanilla) {
                    this.charts.bullVanilla.destroy();
                }
                
                // 动态生成数据点
                const dataPoints = [];
                
                // 当fixedRate为0时，添加微小偏移量，确保蓝色折线显示在坐标轴上方
                const displayFixedRate = fixedRate === 0 ? 0.01 : fixedRate;
                
                // 1. 左侧区间：价格 < 100（涨跌幅 < 0%）
                for (let price = xMin; price <= 100; price += 0.5) {
                    dataPoints.push({x: price, y: displayFixedRate});
                }
                
                // 2. 右侧区间：价格 ≥ 100（涨跌幅 ≥ 0%）
                for (let price = 100; price <= xMax; price += 0.5) {
                    // 计算收益率：参与率 × (期末价格/期初价格 - 1)
                    const returnRate = displayFixedRate + participation * ((price - 100) / 100);
                    dataPoints.push({x: price, y: returnRate});
                }
                
                // 定义自定义注释
                const customAnnotations = {
                    // y=0轴线（到期年化收益率0%）
                    zeroReturnLine: {
                        type: 'line',
                        xMin: xMin,
                        xMax: xMax,
                        yMin: 0,
                        yMax: 0,
                        borderColor: '#000',
                        borderWidth: 2,
                        z: 0
                    },
                    // 挂钩标的实际收益线（斜率为1的直线）
                    actualReturnLine: {
                        type: 'line',
                        xMin: xMin,
                        xMax: xMax,
                        yMin: (xMin - 100),
                        yMax: (xMax - 100),
                        borderColor: '#999',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        z: 0,
                        label: {
                            content: '挂钩标的实际收益',
                            enabled: true,
                            backgroundColor: 'white',
                            borderColor: '#999',
                            borderWidth: 1,
                            padding: 3,
                            font: { weight: 'bold' },
                            position: { x: 'end', y: 'end' }
                        }
                    },
                    // 参与率标签
                    participationLabel: {
                        type: 'label',
                        content: `参与率 ${participation}%`,
                        xValue: xMax - 15,
                        yValue: participation * 0.1 + fixedRate + 0.5,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    },
                    // 最低收益率标签
                    fixedRateLabel: {
                        type: 'label',
                        content: `${fixedRate}%`,
                        xValue: xMin + 5,
                        yValue: fixedRate + 0.3,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    }
                };

                this.charts.bullVanilla = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: dataPoints,
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0,
                            z: 5
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY, customAnnotations),
                        scales: {
                            ...this.getBaseOptions(xMin, xMax, maxY).scales,
                            y: {
                                ...this.getBaseOptions(xMin, xMax, maxY).scales.y,
                                min: -5 // 允许显示负半轴
                            }
                        }
                    }
                });
            },
            
            // 绘制看跌香草图表
            drawBearVanillaChart(participation, fixedRate) {
                const xMin = 80;
                const xMax = 120;
                const maxY = Math.max(fixedRate, participation * 0.2) + 1; // 考虑20%跌幅情况
                
                // 确保Canvas元素存在且Chart对象可用
                const canvas = document.getElementById('vanilla-bearChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bearVanilla) {
                    this.charts.bearVanilla.destroy();
                }
                
                // 动态生成数据点
                const dataPoints = [];
                
                // 当fixedRate为0时，添加微小偏移量，确保蓝色折线显示在坐标轴上方
                const displayFixedRate = fixedRate === 0 ? 0.01 : fixedRate;
                
                // 1. 左侧区间：价格 < 100（涨跌幅 < 0%）
                for (let price = xMin; price <= 100; price += 0.5) {
                    // 计算收益率：参与率 × (1 - 期末价格/期初价格)
                    const returnRate = displayFixedRate + participation * ((100 - price) / 100);
                    dataPoints.push({x: price, y: returnRate});
                }
                
                // 2. 右侧区间：价格 ≥ 100（涨跌幅 ≥ 0%）
                for (let price = 100; price <= xMax; price += 0.5) {
                    dataPoints.push({x: price, y: displayFixedRate});
                }
                
                // 定义自定义注释
                const customAnnotations = {
                    // y=0轴线（到期年化收益率0%）
                    zeroReturnLine: {
                        type: 'line',
                        xMin: xMin,
                        xMax: xMax,
                        yMin: 0,
                        yMax: 0,
                        borderColor: '#000',
                        borderWidth: 2,
                        z: 0
                    },
                    // 挂钩标的实际收益线（斜率为1的直线）
                    actualReturnLine: {
                        type: 'line',
                        xMin: xMin,
                        xMax: xMax,
                        yMin: xMin - 100,
                        yMax: xMax - 100,
                        borderColor: '#999',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        z: 0,
                        label: {
                            content: '挂钩标的实际收益',
                            enabled: true,
                            backgroundColor: 'white',
                            borderColor: '#999',
                            borderWidth: 1,
                            padding: 3,
                            font: { weight: 'bold' },
                            position: { x: 'end', y: 'end' }
                        }
                    },
                    // 参与率标签
                    participationLabel: {
                        type: 'label',
                        content: `参与率 ${participation}%`,
                        xValue: xMin + 15,
                        yValue: participation * 0.1 + fixedRate + 0.5,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    },
                    // 最低收益率标签
                    fixedRateLabel: {
                        type: 'label',
                        content: `${fixedRate}%`,
                        xValue: xMax - 5,
                        yValue: fixedRate + 0.3,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    }
                };

                this.charts.bearVanilla = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: dataPoints,
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0,
                            z: 5
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY, customAnnotations),
                        scales: {
                            ...this.getBaseOptions(xMin, xMax, maxY).scales,
                            x: {
                                ...this.getBaseOptions(xMin, xMax, maxY).scales.x,
                                position: 'zero' // 将x轴显示在y=0的位置
                            },
                            y: {
                                ...this.getBaseOptions(xMin, xMax, maxY).scales.y,
                                min: -5 // 允许显示负半轴
                            }
                        }
                    }
                });
            },
            
            // 绘制所有香草图表
            drawVanillaCharts(isBull, participation, fixedRate) {
                // 绘制两种情况的图表
                this.drawBullVanillaChart(participation, fixedRate);
                this.drawBearVanillaChart(participation, fixedRate);
            },
            
            // 绘制所有价差图表
            drawSpreadCharts(isBull, strikePrice, fixedRate, participation, maxRate, knockOutRate) {
                // 绘制两种情况的图表
                this.drawBullSpreadChart(strikePrice, fixedRate, participation, maxRate, knockOutRate);
                this.drawBearSpreadChart(strikePrice, fixedRate, participation, maxRate, knockOutRate);
            },
            
            // 绘制所有自动赎回图表
            drawAutocallCharts(isBull, knockOutPrice, knockOutRate, fixedRate) {
                // 绘制四种情况的图表
                this.drawBullAutocallKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
                this.drawBullAutocallNonKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
                this.drawBearAutocallKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
                this.drawBearAutocallNonKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
            },
            
            // 绘制看涨自动赎回敲出情形图表
            drawBullAutocallKnockoutChart(knockOutPrice, knockOutRate, fixedRate) {
                const xMin = 80;
                const xMax = 120;
                const maxY = Math.max(knockOutRate, fixedRate) + 1;
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('autocall-bull-knockoutChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bullAutocallKnockout) {
                    this.charts.bullAutocallKnockout.destroy();
                }
                
                // 动态生成数据点（仅显示敲出情形）
                const dataPoints = [];
                
                // 左侧区间：价格 < 敲出价格（未敲出，不显示数据）
                for (let price = xMin; price <= knockOutPrice; price += 0.5) {
                    dataPoints.push({x: price, y: null});
                }
                
                // 右侧区间：价格 > 敲出价格（敲出，收益为敲出利率）
                for (let price = knockOutPrice; price <= xMax; price += 0.5) {
                    dataPoints.push({x: price, y: knockOutRate});
                }
                
                // 定义自定义注释
                const customAnnotations = {
                    // 敲出价格线
                    knockOutLine: {
                        type: 'line',
                        xMin: knockOutPrice,
                        xMax: knockOutPrice,
                        yMin: -0.5,
                        yMax: maxY,
                        borderColor: '#999',
                        borderWidth: 1,
                        borderDash: [5, 5]
                    },
                    // 敲出价格标签
                    knockOutLabel: {
                        type: 'label',
                        content: `${knockOutPrice}%`,
                        xValue: knockOutPrice,
                        yValue: 0.5,
                        backgroundColor: 'white',
                        borderColor: '#999',
                        borderWidth: 1,
                        padding: 3
                    },
                    // 敲出收益率标签
                    knockOutRateLabel: {
                        type: 'label',
                        content: `${knockOutRate}%`,
                        xValue: xMax - 5,
                        yValue: knockOutRate + 0.3,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    }
                };

                this.charts.bullAutocallKnockout = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: dataPoints,
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0,
                            z: 1
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY, customAnnotations),
                        scales: {
                            ...this.getBaseOptions(xMin, xMax, maxY).scales,
                            y: {
                                ...this.getBaseOptions(xMin, xMax, maxY).scales.y,
                                min: -0.5 // 允许显示负半轴
                            }
                        }
                    }
                });
            },
            
            // 绘制看涨自动赎回未敲出情形图表
            drawBullAutocallNonKnockoutChart(knockOutPrice, knockOutRate, fixedRate) {
                const xMin = 80;
                const xMax = 120;
                const maxY = Math.max(knockOutRate, fixedRate) + 1;
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('autocall-bull-nonknockoutChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bullAutocallNonKnockout) {
                    this.charts.bullAutocallNonKnockout.destroy();
                }
                
                // 动态生成数据点（仅显示未敲出情形）
                const dataPoints = [];
                
                // 左侧区间：价格 < 敲出价格（未敲出，收益为固定利率）
                for (let price = xMin; price <= knockOutPrice; price += 0.5) {
                    dataPoints.push({x: price, y: fixedRate});
                }
                
                // 右侧区间：价格 > 敲出价格（敲出，不显示数据）
                for (let price = knockOutPrice; price <= xMax; price += 0.5) {
                    dataPoints.push({x: price, y: null});
                }
                
                // 定义自定义注释
                const customAnnotations = {
                    // 敲出价格线
                    knockOutLine: {
                        type: 'line',
                        xMin: knockOutPrice,
                        xMax: knockOutPrice,
                        yMin: -0.5,
                        yMax: maxY,
                        borderColor: '#999',
                        borderWidth: 1,
                        borderDash: [5, 5]
                    },
                    // 敲出价格标签
                    knockOutLabel: {
                        type: 'label',
                        content: `${knockOutPrice}%`,
                        xValue: knockOutPrice,
                        yValue: 0.5,
                        backgroundColor: 'white',
                        borderColor: '#999',
                        borderWidth: 1,
                        padding: 3
                    },
                    // 固定收益率标签
                    fixedRateLabel: {
                        type: 'label',
                        content: `${fixedRate}%`,
                        xValue: xMin + 5,
                        yValue: fixedRate + 0.3,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    }
                };

                this.charts.bullAutocallNonKnockout = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: dataPoints,
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0,
                            z: 1
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY, customAnnotations),
                        scales: {
                            ...this.getBaseOptions(xMin, xMax, maxY).scales,
                            y: {
                                ...this.getBaseOptions(xMin, xMax, maxY).scales.y,
                                min: -0.5 // 允许显示负半轴
                            }
                        }
                    }
                });
            },
            
            // 绘制看跌自动赎回敲出情形图表
            drawBearAutocallKnockoutChart(knockOutPrice, knockOutRate, fixedRate) {
                const xMin = 80;
                const xMax = 120;
                const maxY = Math.max(knockOutRate, fixedRate) + 1;
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('autocall-bear-knockoutChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bearAutocallKnockout) {
                    this.charts.bearAutocallKnockout.destroy();
                }
                
                // 动态生成数据点（仅显示敲出情形）
                const dataPoints = [];
                
                // 左侧区间：价格 < 敲出价格（敲出，收益为敲出利率）
                for (let price = xMin; price <= knockOutPrice; price += 0.5) {
                    dataPoints.push({x: price, y: knockOutRate});
                }
                
                // 右侧区间：价格 > 敲出价格（未敲出，不显示数据）
                for (let price = knockOutPrice; price <= xMax; price += 0.5) {
                    dataPoints.push({x: price, y: null});
                }
                
                // 定义自定义注释
                const customAnnotations = {
                    // 敲出价格线
                    knockOutLine: {
                        type: 'line',
                        xMin: knockOutPrice,
                        xMax: knockOutPrice,
                        yMin: -0.5,
                        yMax: maxY,
                        borderColor: '#999',
                        borderWidth: 1,
                        borderDash: [5, 5]
                    },
                    // 敲出价格标签
                    knockOutLabel: {
                        type: 'label',
                        content: `${knockOutPrice}%`,
                        xValue: knockOutPrice,
                        yValue: 0.5,
                        backgroundColor: 'white',
                        borderColor: '#999',
                        borderWidth: 1,
                        padding: 3
                    },
                    // 敲出收益率标签
                    knockOutRateLabel: {
                        type: 'label',
                        content: `${knockOutRate}%`,
                        xValue: xMin + 5,
                        yValue: knockOutRate + 0.3,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    }
                };

                this.charts.bearAutocallKnockout = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: dataPoints,
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0,
                            z: 1
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY, customAnnotations),
                        scales: {
                            ...this.getBaseOptions(xMin, xMax, maxY).scales,
                            y: {
                                ...this.getBaseOptions(xMin, xMax, maxY).scales.y,
                                min: -0.5 // 允许显示负半轴
                            }
                        }
                    }
                });
            },
            
            // 绘制看跌自动赎回未敲出情形图表
            drawBearAutocallNonKnockoutChart(knockOutPrice, knockOutRate, fixedRate) {
                const xMin = 80;
                const xMax = 120;
                const maxY = Math.max(knockOutRate, fixedRate) + 1;
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('autocall-bear-nonknockoutChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bearAutocallNonKnockout) {
                    this.charts.bearAutocallNonKnockout.destroy();
                }
                
                // 动态生成数据点（仅显示未敲出情形）
                const dataPoints = [];
                
                // 左侧区间：价格 < 敲出价格（敲出，不显示数据）
                for (let price = xMin; price <= knockOutPrice; price += 0.5) {
                    dataPoints.push({x: price, y: null});
                }
                
                // 右侧区间：价格 > 敲出价格（未敲出，收益为固定利率）
                for (let price = knockOutPrice; price <= xMax; price += 0.5) {
                    dataPoints.push({x: price, y: fixedRate});
                }
                
                // 定义自定义注释
                const customAnnotations = {
                    // 敲出价格线
                    knockOutLine: {
                        type: 'line',
                        xMin: knockOutPrice,
                        xMax: knockOutPrice,
                        yMin: -0.5,
                        yMax: maxY,
                        borderColor: '#999',
                        borderWidth: 1,
                        borderDash: [5, 5]
                    },
                    // 敲出价格标签
                    knockOutLabel: {
                        type: 'label',
                        content: `${knockOutPrice}%`,
                        xValue: knockOutPrice,
                        yValue: 0.5,
                        backgroundColor: 'white',
                        borderColor: '#999',
                        borderWidth: 1,
                        padding: 3
                    },
                    // 固定收益率标签
                    fixedRateLabel: {
                        type: 'label',
                        content: `${fixedRate}%`,
                        xValue: xMax - 5,
                        yValue: fixedRate + 0.3,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    }
                };

                this.charts.bearAutocallNonKnockout = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: dataPoints,
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0,
                            z: 1
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY, customAnnotations),
                        scales: {
                            ...this.getBaseOptions(xMin, xMax, maxY).scales,
                            y: {
                                ...this.getBaseOptions(xMin, xMax, maxY).scales.y,
                                min: -0.5 // 允许显示负半轴
                            }
                        }
                    }
                });
            },
            
            // 绘制看涨价差图表
            drawBullSpreadChart(strikePrice, fixedRate, participation, maxRate, knockOutRate) {
                // 计算涨跌幅范围：期初价为100，涨跌幅=（期末价-100）/100 * 100%
                const xMin = 90; // 期初价的90%，对应涨跌幅-10%
                const xMax = 110; // 期初价的110%，对应涨跌幅10%
                const maxY = Math.max(Math.max(fixedRate, maxRate), knockOutRate) + 0.5;
                
                // 计算关键涨跌幅对应的价格
                const zeroReturnPrice = 100; // 涨跌幅0%
                const upperLimitPrice = strikePrice; // 行权价，对应涨跌幅=（行权价-100）%
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('spread-bullChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bullSpread) {
                    this.charts.bullSpread.destroy();
                }
                
                // 动态生成数据点
                const dataPoints = [];
                
                // 1. 左侧区间：涨跌幅 < 0%（价格 < 100）
                dataPoints.push({x: xMin, y: knockOutRate});
                dataPoints.push({x: zeroReturnPrice, y: knockOutRate});
                
                // 2. 中间区间：0% ≤ 涨跌幅 ≤ 6%（100 ≤ 价格 ≤ 106）
                // 生成多个点以显示线性增长
                for (let price = zeroReturnPrice; price <= upperLimitPrice; price += 0.5) {
                    const returnRate = fixedRate + Math.abs((price - 100) / 100 * 100) * (participation / 100);
                    dataPoints.push({x: price, y: returnRate});
                }
                
                // 3. 右侧区间：涨跌幅 > 6%（价格 > 106）
                dataPoints.push({x: upperLimitPrice, y: maxRate});
                dataPoints.push({x: xMax, y: maxRate});
                
                this.charts.bullSpread = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: dataPoints,
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY),
                        plugins: {
                            ...this.getBaseOptions(xMin, xMax, maxY).plugins,
                            annotation: {
                                annotations: {
                                    ...this.getBaseOptions(xMin, xMax, maxY).plugins.annotation.annotations,
                                    // 区间上限线
                                    upperLimitLine: {
                                        type: 'line',
                                        xMin: upperLimitPrice,
                                        xMax: upperLimitPrice,
                                        yMin: 0,
                                        yMax: maxY,
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    },
                                    // 区间上限标签
                                    upperLimitLabel: {
                                        type: 'label',
                                        content: `${upperLimitPrice}%`,
                                        xValue: upperLimitPrice,
                                        yValue: 0.5,
                                        backgroundColor: 'white',
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 参与率标签
                                    participationLabel: {
                                        type: 'label',
                                        content: `区间参与率 ${participation}%`,
                                        xValue: (zeroReturnPrice + upperLimitPrice) / 2,
                                        yValue: (fixedRate + maxRate) / 2,
                                        backgroundColor: 'white',
                                        borderColor: '#666',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 敲出收益率标签
                                    knockOutRateLabel: {
                                        type: 'label',
                                        content: `${knockOutRate}%`,
                                        xValue: xMin + 5,
                                        yValue: knockOutRate + 0.3,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    },
                                    // 最高收益率标签
                                    maxRateLabel: {
                                        type: 'label',
                                        content: `${maxRate}%`,
                                        xValue: xMax - 5,
                                        yValue: maxRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // 绘制看跌价差图表
            drawBearSpreadChart(strikePrice, fixedRate, participation, maxRate, knockOutRate) {
                // 计算涨跌幅范围：期初价为100，涨跌幅=（期末价-100）/100 * 100%
                const xMin = 90; // 期初价的90%，对应涨跌幅-10%
                const xMax = 110; // 期初价的110%，对应涨跌幅10%
                const maxY = Math.max(Math.max(fixedRate, maxRate), knockOutRate) + 0.5;
                
                // 计算关键涨跌幅对应的价格
                const zeroReturnPrice = 100; // 涨跌幅0%
                const lowerLimitPrice = strikePrice; // 行权价，对应看跌价差的拐点
                
                // 确保Canvas元素存在且Chart.js已加载
                const canvas = document.getElementById('spread-bearChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bearSpread) {
                    this.charts.bearSpread.destroy();
                }
                
                // 动态生成数据点
                const dataPoints = [];
                
                // 1. 左侧区间：价格 < 行权价（涨跌幅 < 行权价对应的涨跌幅）
                // 收益保持maxRate
                dataPoints.push({x: xMin, y: maxRate});
                dataPoints.push({x: lowerLimitPrice, y: maxRate});
                
                // 2. 中间区间：行权价 ≤ 价格 ≤ 100（行权价对应的涨跌幅 ≤ 涨跌幅 ≤ 0%）
                // 收益随价格上升而线性下降
                // 生成多个点以显示线性变化
                for (let price = lowerLimitPrice; price <= zeroReturnPrice; price += 0.5) {
                    // 计算当前价格对应的收益
                    // 当价格=行权价时，收益=maxRate
                    // 当价格=100%时，收益=knockOutRate
                    const priceDiff = (price - lowerLimitPrice) / (zeroReturnPrice - lowerLimitPrice);
                    const returnRate = maxRate - (maxRate - knockOutRate) * priceDiff;
                    dataPoints.push({x: price, y: returnRate});
                }
                
                // 3. 右侧区间：价格 > 100（涨跌幅 > 0%）
                // 收益保持knockOutRate
                dataPoints.push({x: zeroReturnPrice, y: knockOutRate});
                dataPoints.push({x: xMax, y: knockOutRate});
                
                this.charts.bearSpread = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: dataPoints,
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY),
                        plugins: {
                            ...this.getBaseOptions(xMin, xMax, maxY).plugins,
                            annotation: {
                                annotations: {
                                    ...this.getBaseOptions(xMin, xMax, maxY).plugins.annotation.annotations,
                                    // 行权价线（拐点）
                                    lowerLimitLine: {
                                        type: 'line',
                                        xMin: lowerLimitPrice,
                                        xMax: lowerLimitPrice,
                                        yMin: 0,
                                        yMax: maxY,
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    },
                                    // 行权价标签
                                    lowerLimitLabel: {
                                        type: 'label',
                                        content: `${lowerLimitPrice}%`,
                                        xValue: lowerLimitPrice,
                                        yValue: 0.5,
                                        backgroundColor: 'white',
                                        borderColor: '#999',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 参与率标签
                                    participationLabel: {
                                        type: 'label',
                                        content: `区间参与率 ${participation}%`,
                                        xValue: (lowerLimitPrice + zeroReturnPrice) / 2,
                                        yValue: (fixedRate + maxRate) / 2,
                                        backgroundColor: 'white',
                                        borderColor: '#666',
                                        borderWidth: 1,
                                        padding: 3
                                    },
                                    // 敲出收益率标签
                                    knockOutRateLabel: {
                                        type: 'label',
                                        content: `${knockOutRate}%`,
                                        xValue: xMax - 5,
                                        yValue: knockOutRate + 0.8,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    },
                                    // 最高收益率标签
                                    maxRateLabel: {
                                        type: 'label',
                                        content: `${maxRate}%`,
                                        xValue: xMin + 5,
                                        yValue: maxRate,
                                        backgroundColor: 'white',
                                        borderColor: '#004aad',
                                        borderWidth: 1,
                                        padding: 3,
                                        font: { weight: 'bold' }
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // 绘制看涨香草图表

            
            // 绘制自动赎回图表
            drawAutocallCharts(isBull, knockOutPrice, knockOutRate, fixedRate) {
                // 绘制所有四种情况的图表，根据产品方向在generateAutocallProduct中控制显示/隐藏
                this.drawBullAutocallKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
                this.drawBullAutocallNonKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
                this.drawBearAutocallKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
                this.drawBearAutocallNonKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
            },
            
            // 绘制看涨自动赎回图表
            drawBullAutocallChart(knockOutPrice, knockOutRate, fixedRate) {
                const xMin = 80;
                const xMax = 120;
                const maxY = Math.max(knockOutRate, fixedRate) + 1;
                
                // 确保Canvas元素存在且Chart对象可用
                const canvas = document.getElementById('autocall-bullChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bullAutocall) {
                    this.charts.bullAutocall.destroy();
                }
                
                // 动态生成数据点
                const dataPoints = [];
                
                // 当fixedRate为0时，添加微小偏移量，确保蓝色折线显示在坐标轴上方
                const displayFixedRate = fixedRate === 0 ? 0.01 : fixedRate;
                const displayKnockOutRate = knockOutRate === 0 ? 0.01 : knockOutRate;
                
                // 1. 左侧区间：价格 < 100（涨跌幅 < 0%）
                for (let price = xMin; price < 100; price += 0.5) {
                    dataPoints.push({x: price, y: displayFixedRate});
                }
                
                // 2. 中间区间：100 ≤ 价格 ≤ 敲出价格
                for (let price = 100; price <= knockOutPrice; price += 0.5) {
                    dataPoints.push({x: price, y: displayFixedRate});
                }
                
                // 3. 右侧区间：价格 > 敲出价格
                for (let price = knockOutPrice; price <= xMax; price += 0.5) {
                    dataPoints.push({x: price, y: displayKnockOutRate});
                }
                
                // 定义自定义注释
                const customAnnotations = {
                    // y=0轴线（到期年化收益率0%）
                    zeroReturnLine: {
                        type: 'line',
                        xMin: xMin,
                        xMax: xMax,
                        yMin: 0,
                        yMax: 0,
                        borderColor: '#000',
                        borderWidth: 2,
                        z: 0
                    },
                    // 敲出价格线
                    knockOutLine: {
                        type: 'line',
                        xMin: knockOutPrice,
                        xMax: knockOutPrice,
                        yMin: 0,
                        yMax: maxY,
                        borderColor: '#999',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        z: 0
                    },
                    // 敲出价格标签
                    knockOutLabel: {
                        type: 'label',
                        content: `${knockOutPrice}%`,
                        xValue: knockOutPrice,
                        yValue: 0.5,
                        backgroundColor: 'white',
                        borderColor: '#999',
                        borderWidth: 1,
                        padding: 3
                    },
                    // 敲出收益率标签
                    knockOutRateLabel: {
                        type: 'label',
                        content: `${knockOutRate}%`,
                        xValue: xMax - 5,
                        yValue: knockOutRate,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    },
                    // 最低收益率标签
                    fixedRateLabel: {
                        type: 'label',
                        content: `${fixedRate}%`,
                        xValue: xMin + 5,
                        yValue: fixedRate,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    }
                };

                this.charts.bullAutocall = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: dataPoints,
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0,
                            z: 1
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY),
                        plugins: {
                            ...this.getBaseOptions(xMin, xMax, maxY).plugins,
                            annotation: {
                                annotations: {
                                    ...this.getBaseOptions(xMin, xMax, maxY).plugins.annotation.annotations,
                                    ...customAnnotations
                                }
                            }
                        }
                    }
                });
            },
            
            // 绘制看跌自动赎回图表
            drawBearAutocallChart(knockOutPrice, knockOutRate, fixedRate) {
                const xMin = 80;
                const xMax = 120;
                const maxY = Math.max(knockOutRate, fixedRate) + 1;
                
                // 确保Canvas元素存在且Chart对象可用
                const canvas = document.getElementById('autocall-bearChart');
                if (!canvas || typeof Chart === 'undefined') return;
                
                // 销毁旧图表
                if (this.charts.bearAutocall) {
                    this.charts.bearAutocall.destroy();
                }
                
                // 动态生成数据点
                const dataPoints = [];
                
                // 当fixedRate为0时，添加微小偏移量，确保蓝色折线显示在坐标轴上方
                const displayFixedRate = fixedRate === 0 ? 0.01 : fixedRate;
                const displayKnockOutRate = knockOutRate === 0 ? 0.01 : knockOutRate;
                
                // 1. 左侧区间：价格 < 敲出价格
                for (let price = xMin; price < knockOutPrice; price += 0.5) {
                    dataPoints.push({x: price, y: displayKnockOutRate});
                }
                
                // 2. 中间区间：敲出价格 ≤ 价格 ≤ 100
                for (let price = knockOutPrice; price <= 100; price += 0.5) {
                    dataPoints.push({x: price, y: displayFixedRate});
                }
                
                // 3. 右侧区间：价格 > 100（涨跌幅 > 0%）
                for (let price = 100; price <= xMax; price += 0.5) {
                    dataPoints.push({x: price, y: displayFixedRate});
                }
                
                // 定义自定义注释
                const customAnnotations = {
                    // y=0轴线（到期年化收益率0%）
                    zeroReturnLine: {
                        type: 'line',
                        xMin: xMin,
                        xMax: xMax,
                        yMin: 0,
                        yMax: 0,
                        borderColor: '#000',
                        borderWidth: 2,
                        z: 0
                    },
                    // 敲出价格线
                    knockOutLine: {
                        type: 'line',
                        xMin: knockOutPrice,
                        xMax: knockOutPrice,
                        yMin: 0,
                        yMax: maxY,
                        borderColor: '#999',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        z: 0
                    },
                    // 敲出价格标签
                    knockOutLabel: {
                        type: 'label',
                        content: `${knockOutPrice}%`,
                        xValue: knockOutPrice,
                        yValue: 0.5,
                        backgroundColor: 'white',
                        borderColor: '#999',
                        borderWidth: 1,
                        padding: 3
                    },
                    // 敲出收益率标签
                    knockOutRateLabel: {
                        type: 'label',
                        content: `${knockOutRate}%`,
                        xValue: xMin + 5,
                        yValue: knockOutRate,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    },
                    // 最低收益率标签
                    fixedRateLabel: {
                        type: 'label',
                        content: `${fixedRate}%`,
                        xValue: xMax - 5,
                        yValue: fixedRate,
                        backgroundColor: 'white',
                        borderColor: '#004aad',
                        borderWidth: 1,
                        padding: 3,
                        font: { weight: 'bold' }
                    }
                };

                this.charts.bearAutocall = new Chart(canvas, {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: dataPoints,
                            borderColor: '#004aad',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0,
                            z: 1
                        }]
                    },
                    options: {
                        ...this.getBaseOptions(xMin, xMax, maxY),
                        plugins: {
                            ...this.getBaseOptions(xMin, xMax, maxY).plugins,
                            annotation: {
                                annotations: {
                                    ...this.getBaseOptions(xMin, xMax, maxY).plugins.annotation.annotations,
                                    ...customAnnotations
                                }
                            }
                        }
                    }
                });
            },
            
            // 销毁指定类型的图表
            destroyCharts(type) {
                if (type === 'sharkfin') {
                    // 销毁鲨鱼鳍相关图表
                    ['bullKnockOut', 'bullNoKnockOut', 'bearKnockOut', 'bearNoKnockOut'].forEach(chartName => {
                        if (this.charts[chartName]) {
                            this.charts[chartName].destroy();
                            delete this.charts[chartName];
                        }
                    });
                } else if (type === 'binary') {
                    // 销毁二元相关图表
                    ['bullBinary', 'bearBinary'].forEach(chartName => {
                        if (this.charts[chartName]) {
                            this.charts[chartName].destroy();
                            delete this.charts[chartName];
                        }
                    });
                } else if (type === 'spread') {
                    // 销毁价差相关图表
                    ['bullSpread', 'bearSpread'].forEach(chartName => {
                        if (this.charts[chartName]) {
                            this.charts[chartName].destroy();
                            delete this.charts[chartName];
                        }
                    });
                } else if (type === 'vanilla') {
                    // 销毁香草相关图表
                    ['bullVanilla', 'bearVanilla'].forEach(chartName => {
                        if (this.charts[chartName]) {
                            this.charts[chartName].destroy();
                            delete this.charts[chartName];
                        }
                    });
                } else if (type === 'autocall') {
                    // 销毁自动赎回相关图表
                    ['bullAutocall', 'bearAutocall'].forEach(chartName => {
                        if (this.charts[chartName]) {
                            this.charts[chartName].destroy();
                            delete this.charts[chartName];
                        }
                    });
                }
            }
        };

        // PPT导出模块
        const PptExporter = {
            // 获取PPT图表样式配置
            getChartStyle() {
                return {
                    fontFace: 'Microsoft YaHei', // 使用与网页一致的字体
                    border: { width: 1, color: 'CCCCCC' },
                    fill: { color: 'F0F8FF' },
                    title: {
                        fontFace: 'Microsoft YaHei',
                        fontSize: 14,
                        bold: true,
                        color: '004aad'
                    },
                    axis: {
                        fontFace: 'Microsoft YaHei',
                        fontSize: 12,
                        color: '000000'
                    },
                    legend: {
                        fontFace: 'Microsoft YaHei',
                        fontSize: 12,
                        color: '000000'
                    }
                };
            },

            // 生成鲨鱼鳍看涨敲出图表数据
            generateBullKnockOutChartData(knockOutPrice, knockOutRate) {
                const xMin = Math.min(85, knockOutPrice - 10);
                const xMax = Math.max(115, knockOutPrice + 10);
                const step = 5;
                
                const categories = [];
                const values = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    categories.push(`${x}%`);
                    values.push(knockOutRate);
                }
                
                return { categories, values };
            },

            // 生成鲨鱼鳍看涨未敲出图表数据
            generateBullNoKnockOutChartData(knockOutPrice, fixedRate, participation, maxRate) {
                const xMin = Math.min(85, knockOutPrice - 10);
                const xMax = Math.max(115, knockOutPrice + 10);
                const step = 5;
                
                const categories = [];
                const values = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    categories.push(`${x}%`);
                    if (x < 100) {
                        values.push(fixedRate);
                    } else if (x <= knockOutPrice) {
                        // 计算参与收益
                        const change = (x - 100);
                        const returnRate = fixedRate + (change * participation / 100);
                        values.push(Math.min(returnRate, maxRate));
                    } else {
                        values.push(maxRate);
                    }
                }
                
                return { categories, values };
            },

            // 生成鲨鱼鳍看跌敲出图表数据
            generateBearKnockOutChartData(knockOutPrice, knockOutRate) {
                return this.generateBullKnockOutChartData(knockOutPrice, knockOutRate);
            },

            // 生成鲨鱼鳍看跌未敲出图表数据
            generateBearNoKnockOutChartData(knockOutPrice, fixedRate, participation, maxRate) {
                const xMin = Math.min(85, knockOutPrice - 10);
                const xMax = Math.max(115, knockOutPrice + 10);
                const step = 5;
                
                const categories = [];
                const values = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    categories.push(`${x}%`);
                    if (x > 100) {
                        values.push(fixedRate);
                    } else if (x >= knockOutPrice) {
                        // 计算参与收益
                        const change = (100 - x);
                        const returnRate = fixedRate + (change * participation / 100);
                        values.push(Math.min(returnRate, maxRate));
                    } else {
                        values.push(maxRate);
                    }
                }
                
                return { categories, values };
            },

            // 生成自动赎回看涨图表数据
            generateBullAutocallChartData(knockOutPrice, knockOutRate, fixedRate) {
                const xMin = Math.min(85, knockOutPrice - 10);
                const xMax = Math.max(115, knockOutPrice + 10);
                const step = 5;
                
                const categories = [];
                const values = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    categories.push(`${x}%`);
                    if (x >= knockOutPrice) {
                        values.push(knockOutRate);
                    } else {
                        values.push(fixedRate);
                    }
                }
                
                return { categories, values };
            },

            // 生成自动赎回看跌图表数据
            generateBearAutocallChartData(knockOutPrice, knockOutRate, fixedRate) {
                const xMin = Math.min(85, knockOutPrice - 10);
                const xMax = Math.max(115, knockOutPrice + 10);
                const step = 5;
                
                const categories = [];
                const values = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    categories.push(`${x}%`);
                    if (x <= knockOutPrice) {
                        values.push(knockOutRate);
                    } else {
                        values.push(fixedRate);
                    }
                }
                
                return { categories, values };
            },

            // 生成二元看涨图表数据
            generateBullBinaryChartData(strikePrice, fixedRate, binaryRate) {
                const xMin = Math.min(80, strikePrice - 20);
                const xMax = Math.max(120, strikePrice + 20);
                const step = 5;
                
                const categories = [];
                const values = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    categories.push(`${x}%`);
                    values.push(x <= strikePrice ? fixedRate : binaryRate);
                }
                
                return { categories, values };
            },

            // 生成二元看跌图表数据
            generateBearBinaryChartData(strikePrice, fixedRate, binaryRate) {
                const xMin = Math.min(80, strikePrice - 20);
                const xMax = Math.max(120, strikePrice + 20);
                const step = 5;
                
                const categories = [];
                const values = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    categories.push(`${x}%`);
                    values.push(x <= strikePrice ? binaryRate : fixedRate);
                }
                
                return { categories, values };
            },
            
            // 生成看涨价差图表数据
            generateBullSpreadChartData(fixedRate, participation, maxRate) {
                const xMin = Math.min(85, 100 - 15);
                const xMax = Math.max(115, 100 + 15);
                const step = 5;
                
                const categories = [];
                const values = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    categories.push(`${x}%`);
                    if (x < 100) {
                        values.push(fixedRate);
                    } else if (x <= 106) {
                        // 计算参与收益：0.1% + |涨跌幅|×70%
                        const change = (x - 100);
                        const returnRate = fixedRate + (change * participation / 100);
                        values.push(returnRate);
                    } else {
                        values.push(maxRate);
                    }
                }
                
                return { categories, values };
            },
            
            // 生成看跌价差图表数据
            generateBearSpreadChartData(fixedRate, participation, maxRate) {
                const xMin = Math.min(85, 100 - 15);
                const xMax = Math.max(115, 100 + 15);
                const step = 5;
                
                const categories = [];
                const values = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    categories.push(`${x}%`);
                    if (x > 100) {
                        values.push(fixedRate);
                    } else if (x >= 94) {
                        // 计算参与收益：0.1% + |涨跌幅|×70%
                        const change = (100 - x);
                        const returnRate = fixedRate + (change * participation / 100);
                        values.push(returnRate);
                    } else {
                        values.push(maxRate);
                    }
                }
                
                return { categories, values };
            },
            
            // 生成看涨香草图表数据
            generateBullVanillaChartData(fixedRate, participation) {
                const xMin = 80;
                const xMax = 120;
                const step = 5;
                
                const categories = [];
                const values = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    categories.push(`${x}%`);
                    if (x < 100) {
                        values.push(fixedRate);
                    } else {
                        const change = (x - 100);
                        const returnRate = fixedRate + (change * participation / 100);
                        values.push(returnRate);
                    }
                }
                
                return { categories, values };
            },
            
            // 生成看跌香草图表数据
            generateBearVanillaChartData(fixedRate, participation) {
                const xMin = 80;
                const xMax = 120;
                const step = 5;
                
                const categories = [];
                const values = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    categories.push(`${x}%`);
                    if (x >= 100) {
                        values.push(fixedRate);
                    } else {
                        const change = (100 - x);
                        const returnRate = fixedRate + (change * participation / 100);
                        values.push(returnRate);
                    }
                }
                
                return { categories, values };
            },

            // 添加PPT图表
            addChartToSlide(slide, chartData, x, y, w, h, title, chartType = 'line') {
                const chartStyle = this.getChartStyle();
                
                slide.addChart(
                    chartType,
                    [
                        {
                            name: '收益率',
                            labels: chartData.categories,
                            values: chartData.values,
                            color: '0066cc',
                            line: { width: 2 },
                            marker: { size: 0 }
                        }
                    ],
                    {
                        x, y, w, h,
                        title: {
                            text: title,
                            options: {
                                fontFace: chartStyle.fontFace,
                                fontSize: 14,
                                bold: true,
                                color: '004aad'
                            }
                        },
                        dataLabel: {
                            visible: false
                        },
                        chartArea: {
                            fill: chartStyle.fill
                        },
                        axes: {
                            x: {
                                title: {
                                    text: '期末价格/期初价格',
                                    options: {
                                        fontFace: chartStyle.fontFace,
                                        fontSize: 12,
                                        bold: true
                                    }
                                },
                                tick: {
                                    fontFace: chartStyle.fontFace,
                                    fontSize: 10
                                }
                            },
                            y: {
                                title: {
                                    text: '到期年化收益率',
                                    options: {
                                        fontFace: chartStyle.fontFace,
                                        fontSize: 12,
                                        bold: true
                                    }
                                },
                                tick: {
                                    fontFace: chartStyle.fontFace,
                                    fontSize: 10,
                                    formatCode: '0.0%'
                                }
                            }
                        },
                        legend: {
                            position: 'none'
                        }
                    }
                );
            },

            // 导出鲨鱼鳍PPT
            async exportSharkfin(isBull, productData, returnText) {
                try {
                    // 创建PPT实例
                    const pptx = new PptxGenJS();
                    
                    // 设置全局字体和16:9标准比例
                    pptx.defineLayout({ name: 'CUSTOM', width: 13.333, height: 7.5 });
                    
                    // 添加幻灯片
                    const slide = pptx.addSlide();
                    
                    // 1. 添加标题
                    slide.addText('鲨鱼鳍结构产品介绍', {
                        x: 1, y: 0.5, w: 9, h: 1,
                        fontSize: 24,
                        fontFace: 'Microsoft YaHei',
                        bold: true,
                        color: '004aad',
                        hAlign: 'center'
                    });
                    
                    // 2. 添加产品信息表格
                    // 添加收益情况到表格
                    productData.push(['收益情况', returnText]);
                    
                    // 添加表格到幻灯片
                    slide.addTable(productData, {
                        x: 1, y: 1.5, w: 5, h: 5,
                        colWidths: [1.5, 3.5],
                        rowHeights: Array(productData.length).fill(0.7),
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        bold: false,
                        color: '000000',
                        valign: 'middle',
                        hAlign: 'left',
                        fill: { color: 'F8F9FA' },
                        border: { type: 'solid', color: 'E9ECEF', width: 1 },
                        headerRow: {
                            fill: { color: '004aad' },
                            color: 'FFFFFF',
                            bold: true
                        }
                    });
                    
                    // 3. 添加损益图（使用PPT图表而非图片）
                    // 获取当前产品参数
                    const knockOutPrice = parseFloat(document.getElementById('sharkfin-knockOutPrice').value);
                    const fixedRate = parseFloat(document.getElementById('sharkfin-fixedRate').value);
                    const knockOutRate = parseFloat(document.getElementById('sharkfin-knockOutRate').value);
                    const participation = parseFloat(document.getElementById('sharkfin-participation').value);
                    const maxRate = parseFloat(document.getElementById('sharkfin-maxRate').value);
                    
                    // 生成图表数据
                    const knockOutChartData = isBull 
                        ? this.generateBullKnockOutChartData(knockOutPrice, knockOutRate)
                        : this.generateBearKnockOutChartData(knockOutPrice, knockOutRate);
                    
                    const noKnockOutChartData = isBull
                        ? this.generateBullNoKnockOutChartData(knockOutPrice, fixedRate, participation, maxRate)
                        : this.generateBearNoKnockOutChartData(knockOutPrice, fixedRate, participation, maxRate);
                    
                    // 添加图表1（敲出情形）
                    this.addChartToSlide(
                        slide, 
                        knockOutChartData, 
                        6.5, 1.5, 4, 2.5, 
                        isBull ? '看涨-敲出情形' : '看跌-敲出情形'
                    );
                    
                    // 添加图表2（未敲出情形）
                    this.addChartToSlide(
                        slide, 
                        noKnockOutChartData, 
                        6.5, 4.2, 4, 2.5, 
                        isBull ? '看涨-未敲出情形' : '看跌-未敲出情形'
                    );
                    
                    // 4. 添加基本观点和风险提示
                    const baseView = '基本观点：关注本金安全，对标的的走势与涨跌有预期';
                    const riskTip = '风险提示：本产品为结构性产品，收益取决于挂钩标的表现，存在收益波动风险，请根据自身风险承受能力谨慎投资。';
                    
                    slide.addText(baseView, {
                        x: 1, y: 6.8, w: 9.5, h: 0.5,
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        color: '000000'
                    });
                    
                    slide.addText(riskTip, {
                        x: 1, y: 7.2, w: 9.5, h: 0.5,
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        color: 'FF0000'
                    });
                    
                    // 生成并下载PPT
                    const fileName = `鲨鱼鳍结构产品_${isBull ? '看涨' : '看跌'}.pptx`;
                    
                    // 使用更可靠的下载方式
                    await pptx.writeFile(fileName);
                    console.log('PPT导出成功！');
                    return true;
                } catch (err) {
                    console.error('PPT导出失败:', err);
                    throw err;
                }
            },
            
            // 导出价差结构PPT
            async exportSpread(isBull, productData, returnText) {
                try {
                    // 创建PPT实例
                    const pptx = new PptxGenJS();
                    
                    // 设置全局字体和16:9标准比例
                    pptx.defineLayout({ name: 'CUSTOM', width: 13.333, height: 7.5 });
                    
                    // 添加幻灯片
                    const slide = pptx.addSlide();
                    
                    // 1. 添加标题
                    slide.addText('价差结构产品介绍', {
                        x: 1, y: 0.5, w: 9, h: 1,
                        fontSize: 24,
                        fontFace: 'Microsoft YaHei',
                        bold: true,
                        color: '004aad',
                        hAlign: 'center'
                    });
                    
                    // 2. 添加产品信息表格
                    // 添加收益情况到表格
                    productData.push(['收益情况', returnText]);
                    
                    // 添加表格到幻灯片
                    slide.addTable(productData, {
                        x: 1, y: 1.5, w: 5, h: 5,
                        colWidths: [1.5, 3.5],
                        rowHeights: Array(productData.length).fill(0.7),
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        bold: false,
                        color: '000000',
                        valign: 'middle',
                        hAlign: 'left',
                        fill: { color: 'F8F9FA' },
                        border: { type: 'solid', color: 'E9ECEF', width: 1 },
                        headerRow: {
                            fill: { color: '004aad' },
                            color: 'FFFFFF',
                            bold: true
                        }
                    });
                    
                    // 3. 添加损益图
                    // 获取当前产品参数
                    const fixedRate = parseFloat(document.getElementById('spread-fixedRate').value);
                    const participation = parseFloat(document.getElementById('spread-participation').value);
                    const maxRate = parseFloat(document.getElementById('spread-maxRate').value);
                    
                    // 生成图表数据
                    const chartData = isBull
                        ? this.generateBullSpreadChartData(fixedRate, participation, maxRate)
                        : this.generateBearSpreadChartData(fixedRate, participation, maxRate);
                    
                    // 添加图表
                    this.addChartToSlide(
                        slide, 
                        chartData, 
                        6.5, 2.5, 4, 3.5, 
                        isBull ? '看涨价差' : '看跌价差'
                    );
                    
                    // 4. 添加基本观点和风险提示
                    const baseView = '基本观点：关注本金安全，对标的的走势有区间波动预期';
                    const riskTip = '风险提示：本产品为结构性产品，收益取决于挂钩标的表现，存在收益波动风险，请根据自身风险承受能力谨慎投资。';
                    
                    // 添加基本观点
                    slide.addText(baseView, {
                        x: 1, y: 6.8, w: 9.5, h: 0.5,
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        color: '000000'
                    });
                    
                    // 添加风险提示
                    slide.addText(riskTip, {
                        x: 1, y: 7.2, w: 9.5, h: 0.5,
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        color: 'FF0000'
                    });
                    
                    // 生成并下载PPT
                    const fileName = `价差结构产品_${isBull ? '看涨' : '看跌'}.pptx`;
                    
                    // 使用更可靠的下载方式
                    await pptx.writeFile(fileName);
                    console.log('PPT导出成功！');
                    return true;
                } catch (err) {
                    console.error('PPT导出失败:', err);
                    throw err;
                }
            },
            
            // 导出香草结构PPT
            async exportVanilla(isBull, productData, returnText) {
                try {
                    // 创建PPT实例
                    const pptx = new PptxGenJS();
                    
                    // 设置全局字体和16:9标准比例
                    pptx.defineLayout({ name: 'CUSTOM', width: 13.333, height: 7.5 });
                    
                    // 添加幻灯片
                    const slide = pptx.addSlide();
                    
                    // 1. 添加标题
                    slide.addText('香草结构产品介绍', {
                        x: 1, y: 0.5, w: 9, h: 1,
                        fontSize: 24,
                        fontFace: 'Microsoft YaHei',
                        bold: true,
                        color: '004aad',
                        hAlign: 'center'
                    });
                    
                    // 2. 添加产品信息表格
                    // 添加收益情况到表格
                    productData.push(['收益情况', returnText]);
                    
                    // 添加表格到幻灯片
                    slide.addTable(productData, {
                        x: 1, y: 1.5, w: 5, h: 5,
                        colWidths: [1.5, 3.5],
                        rowHeights: Array(productData.length).fill(0.7),
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        bold: false,
                        color: '000000',
                        valign: 'middle',
                        hAlign: 'left',
                        fill: { color: 'F8F9FA' },
                        border: { type: 'solid', color: 'E9ECEF', width: 1 },
                        headerRow: {
                            fill: { color: '004aad' },
                            color: 'FFFFFF',
                            bold: true
                        }
                    });
                    
                    // 3. 添加损益图
                    // 获取当前产品参数
                    const fixedRate = parseFloat(document.getElementById('vanilla-fixedRate').value);
                    const participation = parseFloat(document.getElementById('vanilla-participation').value);
                    
                    // 生成图表数据
                    const chartData = isBull
                        ? this.generateBullVanillaChartData(fixedRate, participation)
                        : this.generateBearVanillaChartData(fixedRate, participation);
                    
                    // 添加图表
                    this.addChartToSlide(
                        slide, 
                        chartData, 
                        6.5, 2.5, 4, 3.5, 
                        isBull ? '看涨香草' : '看跌香草'
                    );
                    
                    // 4. 添加基本观点和风险提示
                    const baseView = '基本观点：关注本金安全，对标的的走势有明确涨跌预期';
                    const riskTip = '风险提示：本产品为结构性产品，收益取决于挂钩标的表现，存在收益波动风险，请根据自身风险承受能力谨慎投资。';
                    
                    // 添加基本观点
                    slide.addText(baseView, {
                        x: 1, y: 6.8, w: 9.5, h: 0.5,
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        color: '000000'
                    });
                    
                    // 添加风险提示
                    slide.addText(riskTip, {
                        x: 1, y: 7.2, w: 9.5, h: 0.5,
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        color: 'FF0000'
                    });
                    
                    // 生成并下载PPT
                    const fileName = `香草结构产品_${isBull ? '看涨' : '看跌'}.pptx`;
                    
                    // 使用更可靠的下载方式
                    await pptx.writeFile(fileName);
                    console.log('PPT导出成功！');
                    return true;
                } catch (err) {
                    console.error('PPT导出失败:', err);
                    throw err;
                }
            },

            // 导出二元结构PPT
            async exportBinary(isBull, productData, returnText) {
                try {
                    // 创建PPT实例
                    const pptx = new PptxGenJS();
                    
                    // 设置全局字体和16:9标准比例
                    pptx.defineLayout({ name: 'CUSTOM', width: 13.333, height: 7.5 });
                    
                    // 添加幻灯片
                    const slide = pptx.addSlide();
                    
                    // 1. 添加标题
                    slide.addText('二元结构产品介绍', {
                        x: 1, y: 0.5, w: 9, h: 1,
                        fontSize: 24,
                        fontFace: 'Microsoft YaHei',
                        bold: true,
                        color: '004aad',
                        hAlign: 'center'
                    });
                    
                    // 2. 添加产品信息表格
                    // 添加收益情况到表格
                    productData.push(['收益情况', returnText]);
                    
                    // 添加表格到幻灯片
                    slide.addTable(productData, {
                        x: 1, y: 1.5, w: 5, h: 5,
                        colWidths: [1.5, 3.5],
                        rowHeights: Array(productData.length).fill(0.7),
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        bold: false,
                        color: '000000',
                        valign: 'middle',
                        hAlign: 'left',
                        fill: { color: 'F8F9FA' },
                        border: { type: 'solid', color: 'E9ECEF', width: 1 },
                        headerRow: {
                            fill: { color: '004aad' },
                            color: 'FFFFFF',
                            bold: true
                        }
                    });
                    
                    // 3. 添加损益图（使用PPT图表而非图片）
                    // 获取当前产品参数
                    const strikePrice = parseFloat(document.getElementById('binary-strikePrice').value);
                    const fixedRate = parseFloat(document.getElementById('binary-fixedRate').value);
                    const binaryRate = parseFloat(document.getElementById('binary-binaryRate').value);
                    
                    // 生成图表数据
                    const chartData = isBull
                        ? this.generateBullBinaryChartData(strikePrice, fixedRate, binaryRate)
                        : this.generateBearBinaryChartData(strikePrice, fixedRate, binaryRate);
                    
                    // 添加图表
                    this.addChartToSlide(
                        slide, 
                        chartData, 
                        6.5, 2.5, 4, 3.5, 
                        isBull ? '看涨二元' : '看跌二元'
                    );
                    
                    // 4. 添加基本观点和风险提示
                    const baseView = '基本观点：关注本金安全，对标的的走势有明确方向预期';
                    const riskTip = '风险提示：本产品为结构性产品，收益取决于挂钩标的表现，存在收益波动风险，请根据自身风险承受能力谨慎投资。';
                    
                    slide.addText(baseView, {
                        x: 1, y: 6.8, w: 9.5, h: 0.5,
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        color: '000000'
                    });
                    
                    slide.addText(riskTip, {
                        x: 1, y: 7.2, w: 9.5, h: 0.5,
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        color: 'FF0000'
                    });
                    
                    // 生成并下载PPT
                    const fileName = `二元结构产品_${isBull ? '看涨' : '看跌'}.pptx`;
                    
                    // 使用更可靠的下载方式
                    await pptx.writeFile(fileName);
                    console.log('PPT导出成功！');
                    return true;
                } catch (err) {
                    console.error('PPT导出失败:', err);
                    throw err;
                }
            },

            // 导出自动赎回结构PPT
            async exportAutocall(isBull, productData, returnText) {
                try {
                    // 创建PPT实例
                    const pptx = new PptxGenJS();
                    
                    // 设置全局字体和16:9标准比例
                    pptx.defineLayout({ name: 'CUSTOM', width: 13.333, height: 7.5 });
                    
                    // 添加幻灯片
                    const slide = pptx.addSlide();
                    
                    // 1. 添加标题
                    slide.addText('自动赎回结构产品介绍', {
                        x: 1, y: 0.5, w: 9, h: 1,
                        fontSize: 24,
                        fontFace: 'Microsoft YaHei',
                        bold: true,
                        color: '004aad',
                        hAlign: 'center'
                    });
                    
                    // 2. 添加产品信息表格
                    // 添加收益情况到表格
                    productData.push(['收益情况', returnText]);
                    
                    // 添加表格到幻灯片
                    slide.addTable(productData, {
                        x: 1, y: 1.5, w: 5, h: 5,
                        colWidths: [1.5, 3.5],
                        rowHeights: Array(productData.length).fill(0.7),
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        bold: false,
                        color: '000000',
                        valign: 'middle',
                        hAlign: 'left',
                        fill: { color: 'F8F9FA' },
                        border: { type: 'solid', color: 'E9ECEF', width: 1 },
                        headerRow: {
                            fill: { color: '004aad' },
                            color: 'FFFFFF',
                            bold: true
                        }
                    });
                    
                    // 3. 添加损益图（使用PPT图表而非图片）
                    // 获取当前产品参数
                    const knockOutPrice = parseFloat(document.getElementById('autocall-knockOutPrice').value);
                    const knockOutRate = parseFloat(document.getElementById('autocall-knockOutRate').value);
                    const fixedRate = parseFloat(document.getElementById('autocall-fixedRate').value);
                    
                    // 生成图表数据
                    const chartData = isBull 
                        ? this.generateBullAutocallChartData(knockOutPrice, knockOutRate, fixedRate)
                        : this.generateBearAutocallChartData(knockOutPrice, knockOutRate, fixedRate);
                    
                    // 添加图表
                    this.addChartToSlide(
                        slide, 
                        chartData, 
                        6.5, 1.5, 4, 5, 
                        isBull ? '看涨自动赎回损益图' : '看跌自动赎回损益图'
                    );
                    
                    // 4. 添加基本观点和风险提示
                    const baseView = '基本观点：关注本金安全，对标的的走势有明确涨跌预期';
                    const riskTip = '风险提示：本产品为结构性产品，收益取决于挂钩标的表现，存在收益波动风险，请根据自身风险承受能力谨慎投资。';
                    
                    slide.addText(baseView, {
                        x: 1, y: 6.8, w: 9.5, h: 0.5,
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        color: '000000'
                    });
                    
                    slide.addText(riskTip, {
                        x: 1, y: 7.2, w: 9.5, h: 0.5,
                        fontSize: 12,
                        fontFace: 'Microsoft YaHei',
                        color: 'FF0000'
                    });
                    
                    // 生成并下载PPT
                    const fileName = `自动赎回结构产品_${isBull ? '看涨' : '看跌'}.pptx`;
                    
                    // 使用更可靠的下载方式
                    await pptx.writeFile(fileName);
                    console.log('PPT导出成功！');
                    return true;
                } catch (err) {
                    console.error('PPT导出失败:', err);
                    throw err;
                }
            }
        };

        // 工具函数模块
        const Utils = {
            // 移除HTML标签，获取纯文本
            htmlToText(html) {
                return String(html || '').replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').trim();
            },
            
            // 显示加载状态
            showLoading(prefix) {
                const btnText = document.getElementById(prefix + '-exportBtnText');
                const loading = document.getElementById(prefix + '-exportLoading');
                btnText.textContent = '导出中...';
                loading.classList.remove('hidden');
            },
            
            // 隐藏加载状态
            hideLoading(prefix) {
                const btnText = document.getElementById(prefix + '-exportBtnText');
                const loading = document.getElementById(prefix + '-exportLoading');
                btnText.textContent = '导出PPT';
                loading.classList.add('hidden');
            }
        };

        // 主应用模块
        const App = {
            // 设置自定义选项的事件监听器
            setupCustomOptionListeners() {
                const productTypes = ['sharkfin', 'binary', 'spread', 'vanilla', 'autocall'];
                
                productTypes.forEach(type => {
                    // 处理挂钩标的的自定义选项
                    const underlyingSelect = document.getElementById(`${type}-underlying`);
                    const customUnderlyingContainer = document.getElementById(`${type}-customUnderlying-container`);
                    
                    if (underlyingSelect && customUnderlyingContainer) {
                        underlyingSelect.addEventListener('change', () => {
                            if (underlyingSelect.value === 'custom') {
                                customUnderlyingContainer.classList.remove('hidden');
                            } else {
                                customUnderlyingContainer.classList.add('hidden');
                            }
                        });
                    }
                    
                    // 处理期限的自定义选项
                    const termSelect = document.getElementById(`${type}-term`);
                    const customTermContainer = document.getElementById(`${type}-customTerm-container`);
                    
                    if (termSelect && customTermContainer) {
                        termSelect.addEventListener('change', () => {
                            if (termSelect.value === 'custom') {
                                customTermContainer.classList.remove('hidden');
                            } else {
                                customTermContainer.classList.add('hidden');
                            }
                        });
                    }
                });
            },
            
            // 生成鲨鱼鳍产品介绍
            generateSharkfinProduct() {
                // 获取输入值
                const direction = document.getElementById('sharkfin-productDirection').value;
                let underlying = document.getElementById('sharkfin-underlying').value;
                let term = document.getElementById('sharkfin-term').value;
                const knockOutPrice = parseFloat(document.getElementById('sharkfin-knockOutPrice').value);
                const fixedRate = parseFloat(document.getElementById('sharkfin-fixedRate').value);
                const knockOutRate = parseFloat(document.getElementById('sharkfin-knockOutRate').value);
                const participation = parseFloat(document.getElementById('sharkfin-participation').value);
                const maxRate = parseFloat(document.getElementById('sharkfin-maxRate').value);
                const subscription = document.getElementById('sharkfin-subscription').value;
                
                // 处理自定义挂钩标的
                if (underlying === 'custom') {
                    underlying = document.getElementById('sharkfin-customUnderlying').value;
                }
                
                // 处理自定义期限
                if (term === 'custom') {
                    term = document.getElementById('sharkfin-customTerm').value;
                }

                // 输入验证
                if (isNaN(knockOutPrice) || isNaN(fixedRate) || isNaN(knockOutRate) || isNaN(participation) || isNaN(maxRate)) {
                    alert('请输入有效的数值');
                    return;
                }

                // 增强的输入验证
                if (maxRate < fixedRate) {
                    alert('最高收益率不能小于最低收益率');
                    return;
                }
                if (knockOutPrice <= 0) {
                    alert('障碍价不能小于0');
                    return;
                }
                if (participation < 0) {
                    alert('区间参与率不能小于0');
                    return;
                }

                // 判断产品方向
                const isBull = direction === 'bull';

                // 显示/隐藏对应方向的图表容器
                const bullContainers = [
                    document.getElementById('sharkfin-bullKnockOutContainer'),
                    document.getElementById('sharkfin-bullNoKnockOutContainer')
                ];
                const bearContainers = [
                    document.getElementById('sharkfin-bearKnockOutContainer'),
                    document.getElementById('sharkfin-bearNoKnockOutContainer')
                ];

                if (isBull) {
                    bullContainers.forEach(container => container.style.display = 'block');
                    bearContainers.forEach(container => container.style.display = 'none');
                } else {
                    bullContainers.forEach(container => container.style.display = 'none');
                    bearContainers.forEach(container => container.style.display = 'block');
                }

                // 更新产品信息
                document.getElementById('sharkfin-infoSubscription').textContent = subscription;
                document.getElementById('sharkfin-infoUnderlying').textContent = underlying;
                document.getElementById('sharkfin-infoTerm').textContent = term === '3M' ? '3个月(3M)' : '6个月(6M)';
                document.getElementById('sharkfin-infoKnockOutPrice').textContent = `期初价的${knockOutPrice}%`;
                document.getElementById('sharkfin-infoDirection').textContent = isBull ? '看涨鲨鱼鳍' : '看跌鲨鱼鳍';
                document.getElementById('sharkfin-infoParticipation').textContent = `${participation}%`;

                // 更新收益规则（优化后更清晰的格式）
                if (isBull) {
                    const knockOutChange = (knockOutPrice - 100).toFixed(1);
                    document.getElementById('sharkfin-infoReturn').innerHTML = `
                        <div class="return-section">
                            <div class="return-condition">情况1：期间或期末敲出</div>
                            <div class="return-result">
                                条件：存续期内<span style="color: #e63946; font-weight: bold;">任一</span>交易日收盘价 ≥ 期初价 × ${knockOutPrice}%<br>
                                收益：到期收益率（年化）= <span class="highlight-text">${fixedRate}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">情况2：未曾敲出</div>
                            <div class="return-result">
                                条件：存续期内每日收盘价 < 期初价 × ${knockOutPrice}%<br>
                                <div style="margin-top: 4px;">
                                    • 若期末涨跌幅 < 0%：到期收益率（年化）= <span class="highlight-text">${fixedRate}%</span><br>
                                    • 若 0% ≤ 期末涨跌幅 ≤ ${knockOutChange}%：到期收益率（年化）= <span class="highlight-text">${fixedRate}% + 期末涨跌幅 × ${participation}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    const knockOutChange = (100 - knockOutPrice).toFixed(1);
                    document.getElementById('sharkfin-infoReturn').innerHTML = `
                        <div class="return-section">
                            <div class="return-condition">情况1：期间或期末敲出</div>
                            <div class="return-result">
                                条件：存续期内<span style="color: #e63946; font-weight: bold;">任一</span>交易日收盘价 ≤ 期初价 × ${knockOutPrice}%<br>
                                收益：到期收益率（年化）= <span class="highlight-text">${fixedRate}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">情况2：未曾敲出</div>
                            <div class="return-result">
                                条件：存续期内每日收盘价 > 期初价 × ${knockOutPrice}%<br>
                                <div style="margin-top: 4px;">
                                    • 若期末涨跌幅 > 0%：到期收益率（年化）= <span class="highlight-text">${fixedRate}%</span><br>
                                    • 若 -${knockOutChange}% ≤ 期末涨跌幅 ≤ 0%：到期收益率（年化）= <span class="highlight-text">${fixedRate}% - 期末涨跌幅 × ${participation}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // 绘制图表
                ChartManager.drawSharkfinCharts(isBull, knockOutPrice, fixedRate, knockOutRate, participation, maxRate);
                
                // 更新报价核心要素参考表格
                this.updateReferenceTable('sharkfin');
            },
            
            // 更新报价核心要素参考表格
            updateReferenceTable(productType) {
                let term, knockOutPrice, fixedRate, knockOutRate;
                let underlying, direction, participation;
                
                // 根据产品类型获取相应的输入值
                if (productType === 'sharkfin') {
                    term = document.getElementById('sharkfin-term').value;
                    if (term === 'custom') {
                        term = document.getElementById('sharkfin-customTerm').value;
                    }
                    knockOutPrice = parseFloat(document.getElementById('sharkfin-knockOutPrice').value);
                    fixedRate = parseFloat(document.getElementById('sharkfin-fixedRate').value);
                    knockOutRate = parseFloat(document.getElementById('sharkfin-knockOutRate').value);
                    // 获取新增的参数
                    underlying = document.getElementById('sharkfin-underlying').value;
                    if (underlying === 'custom') {
                        underlying = document.getElementById('sharkfin-customUnderlying').value;
                    } else {
                        underlying = underlying.split('/')[1]; // 提取标的名称
                    }
                    direction = document.getElementById('sharkfin-productDirection').value === 'bull' ? '看涨' : '看跌';
                    participation = parseFloat(document.getElementById('sharkfin-participation').value);
                } else if (productType === 'binary') {
                    term = document.getElementById('binary-term').value;
                    if (term === 'custom') {
                        term = document.getElementById('binary-customTerm').value;
                    }
                    knockOutPrice = parseFloat(document.getElementById('binary-strikePrice').value);
                    fixedRate = parseFloat(document.getElementById('binary-fixedRate').value);
                    knockOutRate = parseFloat(document.getElementById('binary-binaryRate').value);
                    // 获取新增的参数
                    underlying = document.getElementById('binary-underlying').value;
                    if (underlying === 'custom') {
                        underlying = document.getElementById('binary-customUnderlying').value;
                    } else {
                        underlying = underlying.split('/')[1]; // 提取标的名称
                    }
                    direction = document.getElementById('binary-productDirection').value === 'bull' ? '看涨' : '看跌';
                } else if (productType === 'spread') {
                    term = document.getElementById('spread-term').value;
                    if (term === 'custom') {
                        term = document.getElementById('spread-customTerm').value;
                    }
                    knockOutPrice = parseFloat(document.getElementById('spread-strikePrice').value);
                    fixedRate = parseFloat(document.getElementById('spread-fixedRate').value);
                    participation = parseFloat(document.getElementById('spread-participation').value);
                    maxRate = parseFloat(document.getElementById('spread-maxRate').value);
                    underlying = document.getElementById('spread-underlying').value;
                    if (underlying === 'custom') {
                        underlying = document.getElementById('spread-customUnderlying').value;
                    } else {
                        underlying = underlying.split('/')[1]; // 提取标的名称
                    }
                    direction = document.getElementById('spread-productDirection').value === 'bull' ? '看涨' : '看跌';
                } else if (productType === 'vanilla') {
                    term = document.getElementById('vanilla-term').value;
                    if (term === 'custom') {
                        term = document.getElementById('vanilla-customTerm').value;
                    }
                    fixedRate = parseFloat(document.getElementById('vanilla-fixedRate').value);
                    participation = parseFloat(document.getElementById('vanilla-participation').value);
                    underlying = document.getElementById('vanilla-underlying').value;
                    underlying = underlying === 'custom' ? document.getElementById('vanilla-customUnderlying').value : underlying.split('/')[1];
                    direction = document.getElementById('vanilla-productDirection').value === 'bull' ? '看涨' : '看跌';
                } else if (productType === 'autocall') {
                    term = document.getElementById('autocall-term').value;
                    if (term === 'custom') {
                        term = document.getElementById('autocall-customTerm').value;
                    }
                    knockOutPrice = parseFloat(document.getElementById('autocall-knockOutPrice').value);
                    fixedRate = parseFloat(document.getElementById('autocall-fixedRate').value);
                    knockOutRate = parseFloat(document.getElementById('autocall-knockOutRate').value);
                    // 获取新增的参数
                    underlying = document.getElementById('autocall-underlying').value;
                    if (underlying === 'custom') {
                        underlying = document.getElementById('autocall-customUnderlying').value;
                    } else {
                        underlying = underlying.split('/')[1]; // 提取标的名称
                    }
                    direction = document.getElementById('autocall-productDirection').value === 'bull' ? '看涨' : '看跌';
                }
                
                // 查找对应的表格
                const table = document.querySelector(`#${productType}-content table.min-w-full.border.border-gray-200`);
                if (!table) return;
                
                // 获取表格的tbody
                const tbody = table.querySelector('tbody');
                if (!tbody) return;
                
                // 获取第一行数据
                let row = tbody.querySelector('tr');
                
                // 如果没有行，则创建一行
                if (!row) {
                    row = document.createElement('tr');
                    row.classList.add('text-center');
                    // 根据产品类型创建不同数量的单元格
                    let cellCount;
                    if (productType === 'sharkfin') {
                        cellCount = 8;
                    } else if (productType === 'binary') {
                        cellCount = 7;
                    } else if (productType === 'spread') {
                        cellCount = 8;
                    } else if (productType === 'vanilla') {
                        cellCount = 6;
                    } else if (productType === 'autocall') {
                        cellCount = 7;
                    } else {
                        cellCount = 5;
                    }
                    for (let i = 0; i < cellCount; i++) {
                        const cell = document.createElement('td');
                        cell.classList.add('p-2', 'border', 'border-gray-300');
                        row.appendChild(cell);
                    }
                    tbody.appendChild(row);
                }
                
                // 更新行数据
                const cells = row.querySelectorAll('td');
                if (productType === 'sharkfin') {
                    // 鲨鱼鳍结构有8列
                    if (cells.length >= 8) {
                        cells[0].textContent = '1'; // 序号
                        cells[1].textContent = underlying; // 挂钩标的
                        cells[2].textContent = direction; // 方向
                        cells[3].textContent = term; // 期限
                        cells[4].textContent = `${fixedRate}%`; // 固定收益率（年化）
                        cells[5].textContent = `${participation}%`; // 区间参与率
                        cells[6].textContent = `${knockOutPrice}%S₀`; // 敲出价格
                        cells[7].textContent = `${knockOutRate}%`; // 敲出收益率（年化）
                    }
                } else if (productType === 'binary') {
                    // 二元结构有7列
                    if (cells.length >= 7) {
                        cells[0].textContent = '1'; // 序号
                        cells[1].textContent = underlying; // 挂钩标的
                        cells[2].textContent = direction; // 方向
                        cells[3].textContent = term; // 期限
                        cells[4].textContent = `${fixedRate}%`; // 固定收益率（年化）
                        cells[5].textContent = `${knockOutPrice}%S₀`; // 敲出价格
                        cells[6].textContent = `${knockOutRate}%`; // 二元收益率（年化）
                    }
                } else if (productType === 'spread') {
                    // 价差结构有8列
                    if (cells.length >= 8) {
                        cells[0].textContent = '1'; // 序号
                        cells[1].textContent = underlying; // 挂钩标的
                        cells[2].textContent = direction; // 方向
                        cells[3].textContent = term; // 期限
                        cells[4].textContent = `${fixedRate}%`; // 固定收益率（年化）
                        cells[5].textContent = `${participation}%`; // 区间参与率
                        cells[6].textContent = `${knockOutPrice}%S₀`; // 障碍价
                        cells[7].textContent = `${maxRate}%`; // 最高收益率（年化）
                    }
                } else if (productType === 'vanilla') {
                    // 香草结构有6列
                    if (cells.length >= 6) {
                        cells[0].textContent = '1'; // 序号
                        cells[1].textContent = underlying; // 挂钩标的
                        cells[2].textContent = direction; // 方向
                        cells[3].textContent = term; // 期限
                        cells[4].textContent = `${fixedRate}%`; // 固定收益率（年化）
                        cells[5].textContent = `${participation}%`; // 区间参与率
                    }
                } else if (productType === 'autocall') {
                    // 自动赎回结构有7列
                    if (cells.length >= 7) {
                        cells[0].textContent = '1'; // 序号
                        cells[1].textContent = underlying; // 挂钩标的
                        cells[2].textContent = direction; // 方向
                        cells[3].textContent = term; // 期限
                        cells[4].textContent = `${knockOutPrice}%S₀`; // 敲出价格
                        cells[5].textContent = `${fixedRate}%`; // 固定收益率（年化）
                        cells[6].textContent = `${knockOutRate}%`; // 敲出收益率（年化）
                    }
                } else {
                    // 其他产品结构有5列
                    if (cells.length >= 5) {
                        cells[0].textContent = '1'; // 序号
                        cells[1].textContent = term; // 期限
                        cells[2].textContent = `${knockOutPrice}%S₀`; // 敲出价格
                        cells[3].textContent = `${fixedRate}%`; // 固定收益率（年化）
                        cells[4].textContent = `${knockOutRate}%`; // 敲出收益率（年化）
                    }
                }
            },
            
            // 重置鲨鱼鳍表单
            resetSharkfinForm() {
                document.getElementById('sharkfin-productDirection').value = 'bull';
                document.getElementById('sharkfin-underlying').value = '000905.SH/中证500';
                document.getElementById('sharkfin-term').value = '3M';
                document.getElementById('sharkfin-knockOutPrice').value = '106.00';
                document.getElementById('sharkfin-fixedRate').value = '1.00';
                document.getElementById('sharkfin-participation').value = '115.00';
                document.getElementById('sharkfin-maxRate').value = '7.90';
                document.getElementById('sharkfin-subscription').value = '单笔5万元起认购，1万元追加';
                
                // 重新生成产品
                this.generateSharkfinProduct();
            },

            // 导出鲨鱼鳍PPT
            async exportSharkfinToPPT() {
                try {
                    // 显示加载状态
                    Utils.showLoading('sharkfin');
                    
                    // 获取当前产品数据
                    const direction = document.getElementById('sharkfin-productDirection').value;
                    const isBull = direction === 'bull';
                    
                    // 准备产品数据
                    const productData = [
                        ['认购起点', document.getElementById('sharkfin-infoSubscription').textContent],
                        ['挂钩标的名称（代码）', document.getElementById('sharkfin-infoUnderlying').textContent],
                        ['期限', document.getElementById('sharkfin-infoTerm').textContent],
                        ['障碍价（敲出价）', document.getElementById('sharkfin-infoKnockOutPrice').textContent],
                        ['结构方向', document.getElementById('sharkfin-infoDirection').textContent],
                        ['区间参与率', document.getElementById('sharkfin-infoParticipation').textContent]
                    ];
                    
                    // 获取收益情况文本
                    const returnHtml = document.getElementById('sharkfin-infoReturn').innerHTML || '';
                    const returnText = Utils.htmlToText(returnHtml);
                    
                    // 导出PPT
                    await PptExporter.exportSharkfin(isBull, productData, returnText);
                    
                    // 隐藏加载状态
                    Utils.hideLoading('sharkfin');
                } catch (err) {
                    console.error('PPT导出过程中发生错误:', err);
                    // 隐藏加载状态
                    Utils.hideLoading('sharkfin');
                    alert('PPT导出失败，请重试！错误信息：' + err.message);
                }
            },

            // 生成二元产品介绍
            generateBinaryProduct() {
                // 获取输入值
                const direction = document.getElementById('binary-productDirection').value;
                let underlying = document.getElementById('binary-underlying').value;
                let term = document.getElementById('binary-term').value;
                const strikePrice = parseFloat(document.getElementById('binary-strikePrice').value);
                const fixedRate = parseFloat(document.getElementById('binary-fixedRate').value);
                const binaryRate = parseFloat(document.getElementById('binary-binaryRate').value);
                const subscription = document.getElementById('binary-subscription').value;
                
                // 处理自定义挂钩标的
                if (underlying === 'custom') {
                    underlying = document.getElementById('binary-customUnderlying').value;
                }
                
                // 处理自定义期限
                if (term === 'custom') {
                    term = document.getElementById('binary-customTerm').value;
                }

                // 输入验证
                if (isNaN(strikePrice) || isNaN(fixedRate) || isNaN(binaryRate)) {
                    alert('请输入有效的数值');
                    return;
                }

                // 增强的输入验证
                if (binaryRate < fixedRate) {
                    alert('二元收益率不能小于固定收益率');
                    return;
                }
                if (strikePrice <= 0) {
                    alert('行权价不能小于0');
                    return;
                }

                // 判断产品方向
                const isBull = direction === 'bull';

                // 显示/隐藏对应方向的图表容器
                const bullContainer = document.getElementById('binary-bullContainer');
                const bearContainer = document.getElementById('binary-bearContainer');

                if (isBull) {
                    bullContainer.style.display = 'block';
                    bearContainer.style.display = 'none';
                } else {
                    bullContainer.style.display = 'none';
                    bearContainer.style.display = 'block';
                }

                // 更新产品信息
                document.getElementById('binary-infoSubscription').textContent = subscription;
                document.getElementById('binary-infoUnderlying').textContent = underlying;
                document.getElementById('binary-infoTerm').textContent = term === '3M' ? '3个月(3M)' : '6个月(6M)';
                document.getElementById('binary-infoStrikePrice').textContent = `期初价的${strikePrice}%`;
                document.getElementById('binary-infoDirection').textContent = isBull ? '看涨二元' : '看跌二元';
                document.getElementById('binary-infoFixedRate').textContent = `${fixedRate}%`;
                document.getElementById('binary-infoBinaryRate').textContent = `${binaryRate}%`;

                // 更新收益规则
                if (isBull) {
                    document.getElementById('binary-infoReturn').innerHTML = `
                        <div class="return-section">
                            <div class="return-condition">情况1：到期触发二元收益</div>
                            <div class="return-result">
                                条件：期末价格 ≥ 期初价格 × ${strikePrice}%<br>
                                收益：到期收益率（年化）= <span class="highlight-text">${binaryRate}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">情况2：到期获得固定收益</div>
                            <div class="return-result">
                                条件：期末价格 < 期初价格 × ${strikePrice}%<br>
                                收益：到期收益率（年化）= <span class="highlight-text">${fixedRate}%</span>
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('binary-infoReturn').innerHTML = `
                        <div class="return-section">
                            <div class="return-condition">情况1：到期触发二元收益</div>
                            <div class="return-result">
                                条件：期末价格 < 期初价格 × ${strikePrice}%<br>
                                收益：到期收益率（年化）= <span class="highlight-text">${binaryRate}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">情况2：到期获得固定收益</div>
                            <div class="return-result">
                                条件：期末价格 ≥ 期初价格 × ${strikePrice}%<br>
                                收益：到期收益率（年化）= <span class="highlight-text">${fixedRate}%</span>
                            </div>
                        </div>
                    `;
                }

                // 绘制图表
                ChartManager.drawBinaryCharts(isBull, strikePrice, fixedRate, binaryRate);
                
                // 更新报价核心要素参考表格
                this.updateReferenceTable('binary');
            },

            // 重置二元表单
            resetBinaryForm() {
                document.getElementById('binary-productDirection').value = 'bull';
                document.getElementById('binary-underlying').value = '000300.SH/沪深300';
                document.getElementById('binary-term').value = '3M';
                document.getElementById('binary-strikePrice').value = '102.00';
                document.getElementById('binary-fixedRate').value = '2.10';
                document.getElementById('binary-binaryRate').value = '3.60';
                document.getElementById('binary-subscription').value = '单笔5万元起认购，1万元追加';
                
                // 重新生成产品
                this.generateBinaryProduct();
            },

            // 导出二元PPT
            async exportBinaryToPPT() {
                try {
                    // 显示加载状态
                    Utils.showLoading('binary');
                    
                    // 获取当前产品数据
                    const direction = document.getElementById('binary-productDirection').value;
                    const isBull = direction === 'bull';
                    
                    // 准备产品数据
                    const productData = [
                        ['认购起点', document.getElementById('binary-infoSubscription').textContent],
                        ['挂钩标的名称（代码）', document.getElementById('binary-infoUnderlying').textContent],
                        ['期限', document.getElementById('binary-infoTerm').textContent],
                        ['行权价', document.getElementById('binary-infoStrikePrice').textContent],
                        ['结构方向', document.getElementById('binary-infoDirection').textContent],
                        ['固定收益率（年化）', document.getElementById('binary-infoFixedRate').textContent],
                        ['二元收益率（年化）', document.getElementById('binary-infoBinaryRate').textContent]
                    ];
                    
                    // 获取收益情况文本
                    const returnHtml = document.getElementById('binary-infoReturn').innerHTML || '';
                    const returnText = Utils.htmlToText(returnHtml);
                    
                    // 导出PPT
                    await PptExporter.exportBinary(isBull, productData, returnText);
                    
                    // 隐藏加载状态
                    Utils.hideLoading('binary');
                } catch (err) {
                    console.error('PPT导出过程中发生错误:', err);
                    // 隐藏加载状态
                    Utils.hideLoading('binary');
                    alert('PPT导出失败，请重试！错误信息：' + err.message);
                }
            },
            // 生成价差产品介绍
            generateSpreadProduct() {
                // 获取输入值
                const direction = document.getElementById('spread-productDirection').value;
                let underlying = document.getElementById('spread-underlying').value;
                let term = document.getElementById('spread-term').value;
                const strikePrice = parseFloat(document.getElementById('spread-strikePrice').value);
                const fixedRate = parseFloat(document.getElementById('spread-fixedRate').value);
                const participation = parseFloat(document.getElementById('spread-participation').value);
                const maxRate = parseFloat(document.getElementById('spread-maxRate').value);
                const knockOutRate = parseFloat(document.getElementById('spread-knockOutRate').value);
                const subscription = document.getElementById('spread-subscription').value;
                
                // 处理自定义挂钩标的
                if (underlying === 'custom') {
                    underlying = document.getElementById('spread-customUnderlying').value;
                }
                
                // 处理自定义期限
                if (term === 'custom') {
                    term = document.getElementById('spread-customTerm').value;
                }

                // 输入验证
                if (isNaN(strikePrice) || isNaN(fixedRate) || isNaN(participation) || isNaN(maxRate) || isNaN(knockOutRate)) {
                    alert('请输入有效的数值');
                    return;
                }

                // 增强的输入验证
                if (maxRate <= fixedRate) {
                    alert('最高收益率不能小于或等于最低收益率');
                    return;
                }
                if (strikePrice <= 0) {
                    alert('行权价不能小于0');
                    return;
                }
                if (participation < 0) {
                    alert('参与率不能小于0');
                    return;
                }

                // 判断产品方向
                const isBull = direction === 'bull';

                // 显示/隐藏对应方向的图表容器
                const bullContainer = document.getElementById('spread-bullContainer');
                const bearContainer = document.getElementById('spread-bearContainer');

                if (isBull) {
                    bullContainer.style.display = 'block';
                    bearContainer.style.display = 'none';
                } else {
                    bullContainer.style.display = 'none';
                    bearContainer.style.display = 'block';
                }

                // 更新产品信息
                document.getElementById('spread-infoSubscription').textContent = subscription;
                document.getElementById('spread-infoUnderlying').textContent = underlying;
                document.getElementById('spread-infoTerm').textContent = term === '3M' ? '3个月(3M)' : '6个月(6M)';
                document.getElementById('spread-infoStrikePrice').textContent = `期初价的${strikePrice}%`;
                document.getElementById('spread-infoDirection').textContent = isBull ? '看涨价差' : '看跌价差';
                document.getElementById('spread-infoFixedRate').textContent = `${fixedRate}%`;
                document.getElementById('spread-infoParticipation').textContent = `${participation}%`;
                document.getElementById('spread-infoMaxRate').textContent = `${maxRate}%`;
                document.getElementById('spread-infoKnockOutRate').textContent = `${knockOutRate}%`;

                // 计算关键价格和涨跌幅
                const upperLimitChange = (strikePrice - 100).toFixed(1);
                const lowerLimitPrice = (200 - strikePrice).toFixed(2);
                const lowerLimitChange = (lowerLimitPrice - 100).toFixed(1);
                
                // 更新收益规则
                if (isBull) {
                    document.getElementById('spread-infoReturn').innerHTML = `
                        <div class="return-section">
                            <div class="return-condition">情况1：期末涨跌幅 < 0%</div>
                            <div class="return-result">
                                收益：到期收益率（年化）= <span class="highlight-text">${knockOutRate}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">情况2：0% ≤ 期末涨跌幅 ≤ ${upperLimitChange}%</div>
                            <div class="return-result">
                                收益：到期收益率（年化）= <span class="highlight-text">${fixedRate}% + |期末涨跌幅| × ${participation}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">情况3：期末涨跌幅 > ${upperLimitChange}%</div>
                            <div class="return-result">
                                收益：到期收益率（年化）= <span class="highlight-text">${maxRate}%</span>
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('spread-infoReturn').innerHTML = `
                        <div class="return-section">
                            <div class="return-condition">情况1：0% < 期末涨跌幅</div>
                            <div class="return-result">
                                收益：到期收益率（年化）= <span class="highlight-text">${knockOutRate}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">情况2：${lowerLimitPrice}% ≤ 期末价格/期初价格 ≤ 100%（即${lowerLimitChange}% ≤ 期末涨跌幅 ≤ 0%）</div>
                            <div class="return-result">
                                收益：到期收益率（年化）= <span class="highlight-text">${fixedRate}% + |期末涨跌幅| × ${participation}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">情况3：期末价格/期初价格 < ${lowerLimitPrice}%（即期末涨跌幅 < ${lowerLimitChange}%）</div>
                            <div class="return-result">
                                收益：到期收益率（年化）= <span class="highlight-text">${maxRate}%</span>
                            </div>
                        </div>
                    `;
                }

                // 绘制图表
                ChartManager.drawSpreadCharts(isBull, strikePrice, fixedRate, participation, maxRate, knockOutRate);
                
                // 更新报价核心要素参考表格
                this.updateReferenceTable('spread');
            },

            // 重置价差表单
            resetSpreadForm() {
                document.getElementById('spread-productDirection').value = 'bull';
                document.getElementById('spread-underlying').value = 'N225.GI/日经225指数';
                document.getElementById('spread-term').value = '3M';
                document.getElementById('spread-strikePrice').value = '106.00';
                document.getElementById('spread-fixedRate').value = '0.10';
                document.getElementById('spread-knockOutRate').value = '0.10';
                document.getElementById('spread-participation').value = '70.00';
                document.getElementById('spread-maxRate').value = '4.30';
                document.getElementById('spread-subscription').value = '单笔5万元起认购，1万元追加';
                
                // 重新生成产品
                this.generateSpreadProduct();
            },

            // 导出价差PPT
            async exportSpreadToPPT() {
                try {
                    // 显示加载状态
                    Utils.showLoading('spread');
                    
                    // 获取当前产品数据
                    const direction = document.getElementById('spread-productDirection').value;
                    const isBull = direction === 'bull';
                    
                    // 准备产品数据
                    const productData = [
                        ['认购起点', document.getElementById('spread-infoSubscription').textContent],
                        ['挂钩标的名称（代码）', document.getElementById('spread-infoUnderlying').textContent],
                        ['期限', document.getElementById('spread-infoTerm').textContent],
                        ['行权价', document.getElementById('spread-infoStrikePrice').textContent],
                        ['结构方向', document.getElementById('spread-infoDirection').textContent],
                        ['固定收益率（年化）', document.getElementById('spread-infoFixedRate').textContent],
                        ['敲出收益率（年化）', document.getElementById('spread-infoKnockOutRate').textContent],
                        ['参与率', document.getElementById('spread-infoParticipation').textContent],
                        ['最高收益率（年化）', document.getElementById('spread-infoMaxRate').textContent]
                    ];
                    
                    // 获取收益情况文本
                    const returnHtml = document.getElementById('spread-infoReturn').innerHTML || '';
                    const returnText = Utils.htmlToText(returnHtml);
                    
                    // 导出PPT
                    await PptExporter.exportSpread(isBull, productData, returnText);
                    
                    // 隐藏加载状态
                    Utils.hideLoading('spread');
                } catch (err) {
                    console.error('PPT导出过程中发生错误:', err);
                    // 隐藏加载状态
                    Utils.hideLoading('spread');
                    alert('PPT导出失败，请重试！错误信息：' + err.message);
                }
            },

            // 生成香草产品介绍
            generateVanillaProduct() {
                // 获取输入值
                const direction = document.getElementById('vanilla-productDirection').value;
                let underlying = document.getElementById('vanilla-underlying').value;
                let term = document.getElementById('vanilla-term').value;
                const participation = parseFloat(document.getElementById('vanilla-participation').value);
                const fixedRate = parseFloat(document.getElementById('vanilla-fixedRate').value);
                const subscription = document.getElementById('vanilla-subscription').value;
                
                // 处理自定义挂钩标的
                if (underlying === 'custom') {
                    underlying = document.getElementById('vanilla-customUnderlying').value;
                }
                
                // 处理自定义期限
                if (term === 'custom') {
                    term = document.getElementById('vanilla-customTerm').value;
                }

                // 输入验证
                if (isNaN(participation) || isNaN(fixedRate)) {
                    alert('请输入有效的数值');
                    return;
                }

                // 增强的输入验证
                if (participation < 0) {
                    alert('参与率不能小于0');
                    return;
                }
                if (fixedRate < 0) {
                    alert('最低收益率不能小于0');
                    return;
                }

                // 判断产品方向
                const isBull = direction === 'bull';

                // 显示/隐藏对应方向的图表容器
                const bullContainer = document.getElementById('vanilla-bullContainer');
                const bearContainer = document.getElementById('vanilla-bearContainer');

                if (isBull) {
                    bullContainer.style.display = 'block';
                    bearContainer.style.display = 'none';
                } else {
                    bullContainer.style.display = 'none';
                    bearContainer.style.display = 'block';
                }

                // 更新产品信息
                document.getElementById('vanilla-infoSubscription').textContent = subscription;
                document.getElementById('vanilla-infoUnderlying').textContent = underlying;
                document.getElementById('vanilla-infoTerm').textContent = term === '3M' ? '3个月(3M)' : '6个月(6M)';
                document.getElementById('vanilla-infoDirection').textContent = isBull ? '看涨香草' : '看跌香草';
                document.getElementById('vanilla-infoParticipation').textContent = `${participation}%`;
                document.getElementById('vanilla-infoFixedRate').textContent = `${fixedRate}%`;

                // 更新收益规则
                if (isBull) {
                    document.getElementById('vanilla-infoReturn').innerHTML = `
                        <div class="return-section">
                            <div class="return-condition">情况1：期末价格 ≥ 期初价格</div>
                            <div class="return-result">
                                收益：年化收益率 = <span class="highlight-text">${participation}% × (期末价格/期初价格 - 1) + ${fixedRate}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">情况2：期末价格 < 期初价格</div>
                            <div class="return-result">
                                收益：年化收益率 = <span class="highlight-text">最低收益率 = ${fixedRate}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">到期收益金额计算</div>
                            <div class="return-result">
                                到期收益金额 = 认购金额 × 年化收益率 × 期限/365
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('vanilla-infoReturn').innerHTML = `
                        <div class="return-section">
                            <div class="return-condition">情况1：期末价格 < 期初价格</div>
                            <div class="return-result">
                                收益：年化收益率 = <span class="highlight-text">${participation}% × (1 - 期末价格/期初价格) + ${fixedRate}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">情况2：期末价格 ≥ 期初价格</div>
                            <div class="return-result">
                                收益：年化收益率 = <span class="highlight-text">最低收益率 = ${fixedRate}%</span>
                            </div>
                        </div>
                        <div class="return-section">
                            <div class="return-condition">到期收益金额计算</div>
                            <div class="return-result">
                                到期收益金额 = 认购金额 × 年化收益率 × 期限/365
                            </div>
                        </div>
                    `;
                }

                // 绘制图表
                ChartManager.drawVanillaCharts(isBull, participation, fixedRate);
                
                // 更新报价核心要素参考表格
                this.updateReferenceTable('vanilla');
            },

            // 重置香草表单
            resetVanillaForm() {
                document.getElementById('vanilla-productDirection').value = 'bull';
                document.getElementById('vanilla-underlying').value = '931995.CSI/中证国泰海通大类动态配置指数';
                document.getElementById('vanilla-term').value = '3M';
                document.getElementById('vanilla-participation').value = '50.00';
                document.getElementById('vanilla-fixedRate').value = '0.00';
                document.getElementById('vanilla-subscription').value = '单笔5万元起认购，1万元追加';
                
                // 重新生成产品
                this.generateVanillaProduct();
            },

            // 导出香草PPT
            async exportVanillaToPPT() {
                try {
                    // 显示加载状态
                    Utils.showLoading('vanilla');
                    
                    // 获取当前产品数据
                    const direction = document.getElementById('vanilla-productDirection').value;
                    const isBull = direction === 'bull';
                    
                    // 准备产品数据
                    const productData = [
                        ['认购起点', document.getElementById('vanilla-infoSubscription').textContent],
                        ['挂钩标的名称（代码）', document.getElementById('vanilla-infoUnderlying').textContent],
                        ['期限', document.getElementById('vanilla-infoTerm').textContent],
                        ['结构方向', document.getElementById('vanilla-infoDirection').textContent],
                        ['参与率', document.getElementById('vanilla-infoParticipation').textContent],
                        ['最低收益率（年化）', document.getElementById('vanilla-infoFixedRate').textContent]
                    ];
                    
                    // 获取收益情况文本
                    const returnHtml = document.getElementById('vanilla-infoReturn').innerHTML || '';
                    const returnText = Utils.htmlToText(returnHtml);
                    
                    // 导出PPT
                    await PptExporter.exportVanilla(isBull, productData, returnText);
                    
                    // 隐藏加载状态
                    Utils.hideLoading('vanilla');
                } catch (err) {
                    console.error('PPT导出过程中发生错误:', err);
                    // 隐藏加载状态
                    Utils.hideLoading('vanilla');
                    alert('PPT导出失败，请重试！错误信息：' + err.message);
                }
            },

            // 生成自动赎回产品
            generateAutocallProduct() {
                // 获取输入值
                const direction = document.getElementById('autocall-productDirection').value;
                let underlying = document.getElementById('autocall-underlying').value;
                let term = document.getElementById('autocall-term').value;
                const observationFrequency = document.getElementById('autocall-observationFrequency').value;
                const knockOutPrice = parseFloat(document.getElementById('autocall-knockOutPrice').value);
                const knockOutRate = parseFloat(document.getElementById('autocall-knockOutRate').value);
                const fixedRate = parseFloat(document.getElementById('autocall-fixedRate').value);
                const subscription = document.getElementById('autocall-subscription').value;
                
                // 处理自定义挂钩标的
                if (underlying === 'custom') {
                    underlying = document.getElementById('autocall-customUnderlying').value;
                }
                
                // 处理自定义期限
                if (term === 'custom') {
                    term = document.getElementById('autocall-customTerm').value;
                }

                const isBull = direction === 'bull';

                // 更新产品信息
                document.getElementById('autocall-infoSubscription').textContent = subscription;
                document.getElementById('autocall-infoUnderlying').textContent = underlying;
                document.getElementById('autocall-infoTerm').textContent = term;
                document.getElementById('autocall-infoDirection').textContent = isBull ? '看涨自动赎回' : '看跌自动赎回';
                document.getElementById('autocall-infoObservationFrequency').textContent = observationFrequency === 'monthly' ? '每月定期敲出观察' : observationFrequency === 'weekly' ? '每周定期敲出观察' : '每日定期敲出观察';
                document.getElementById('autocall-infoKnockOutPrice').textContent = `${knockOutPrice}%`;
                document.getElementById('autocall-infoKnockOutRate').textContent = `${knockOutRate}%`;
                document.getElementById('autocall-infoFixedRate').textContent = `${fixedRate}%`;

                // 更新收益情况
                document.getElementById('autocall-infoReturn').innerHTML = `
                    <div class="return-section">
                        <div class="return-condition">情况1：存续期内触发敲出</div>
                        <div class="return-result">
                            条件：存续期间<span style="color: #e63946; font-weight: bold;">任意一个月度敲出观察日</span>收盘价 ≥ 敲出价格(期初价格×102%)<br>
                            收益：年化收益率 = <span class="highlight-text">5.0%</span>
                        </div>
                    </div>
                    <div class="return-section">
                        <div class="return-condition">情况2：到期未触发敲出</div>
                        <div class="return-result">
                            条件：存续期间所有月度观察日收盘价 < 敲出价格(期初价格×102%)<br>
                            收益：年化收益率 = <span class="highlight-text">0.1%</span>
                        </div>
                    </div>
                `;

                // 根据产品方向显示/隐藏对应的图表容器
                const bullKnockoutContainer = document.getElementById('autocall-bull-knockoutContainer');
                const bullNonknockoutContainer = document.getElementById('autocall-bull-nonknockoutContainer');
                const bearKnockoutContainer = document.getElementById('autocall-bear-knockoutContainer');
                const bearNonknockoutContainer = document.getElementById('autocall-bear-nonknockoutContainer');
                
                if (isBull) {
                    // 显示看涨相关图表，隐藏看跌相关图表
                    bullKnockoutContainer.style.display = 'block';
                    bullNonknockoutContainer.style.display = 'block';
                    bearKnockoutContainer.style.display = 'none';
                    bearNonknockoutContainer.style.display = 'none';
                    // 绘制看涨的两个情形图表
                    ChartManager.drawBullAutocallKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
                    ChartManager.drawBullAutocallNonKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
                } else {
                    // 显示看跌相关图表，隐藏看涨相关图表
                    bullKnockoutContainer.style.display = 'none';
                    bullNonknockoutContainer.style.display = 'none';
                    bearKnockoutContainer.style.display = 'block';
                    bearNonknockoutContainer.style.display = 'block';
                    // 绘制看跌的两个情形图表
                    ChartManager.drawBearAutocallKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
                    ChartManager.drawBearAutocallNonKnockoutChart(knockOutPrice, knockOutRate, fixedRate);
                }
                
                // 更新报价核心要素参考表格
                this.updateReferenceTable('autocall');
            },

            // 重置自动赎回表单
            resetAutocallForm() {
                document.getElementById('autocall-productDirection').value = 'bull';
                document.getElementById('autocall-underlying').value = '000905.SH/中证500';
                document.getElementById('autocall-term').value = '6M';
                document.getElementById('autocall-observationFrequency').value = 'monthly';
                document.getElementById('autocall-knockOutPrice').value = '102.00';
                document.getElementById('autocall-knockOutRate').value = '5.00';
                document.getElementById('autocall-fixedRate').value = '0.10';
                document.getElementById('autocall-subscription').value = '单笔5万元起认购，1万元追加';
                
                // 重新生成产品
                this.generateAutocallProduct();
            },

            // 导出自动赎回PPT
            async exportAutocallToPPT() {
                try {
                    // 显示加载状态
                    Utils.showLoading('autocall');
                    
                    // 获取当前产品数据
                    const direction = document.getElementById('autocall-productDirection').value;
                    const isBull = direction === 'bull';
                    
                    // 准备产品数据
                    const productData = [
                        ['认购起点', document.getElementById('autocall-infoSubscription').textContent],
                        ['挂钩标的名称（代码）', document.getElementById('autocall-infoUnderlying').textContent],
                        ['期限', document.getElementById('autocall-infoTerm').textContent],
                        ['结构方向', document.getElementById('autocall-infoDirection').textContent],
                        ['敲出观察频率', document.getElementById('autocall-infoObservationFrequency').textContent],
                        ['敲出价格', document.getElementById('autocall-infoKnockOutPrice').textContent],
                        ['敲出收益率（年化）', document.getElementById('autocall-infoKnockOutRate').textContent],
                        ['最低收益率（年化）', document.getElementById('autocall-infoFixedRate').textContent]
                    ];
                    
                    // 获取收益情况文本
                    const returnHtml = document.getElementById('autocall-infoReturn').innerHTML || '';
                    const returnText = Utils.htmlToText(returnHtml);
                    
                    // 导出PPT
                    await PptExporter.exportAutocall(isBull, productData, returnText);
                    
                    // 隐藏加载状态
                    Utils.hideLoading('autocall');
                } catch (err) {
                    console.error('PPT导出过程中发生错误:', err);
                    // 隐藏加载状态
                    Utils.hideLoading('autocall');
                    alert('PPT导出失败，请重试！错误信息：' + err.message);
                }
            }
        };

        // 初始化，确保Chart.js完全加载
        window.onload = () => {
            // 确保Chart.js完全加载后再初始化图表
            const checkChartLoaded = () => {
                if (typeof Chart !== 'undefined') {
                    // 设置自定义选项的事件监听器
                    App.setupCustomOptionListeners();
                    
                    // Chart.js已加载，初始化所有图表
                    App.generateSharkfinProduct();
                    App.generateBinaryProduct();
                    App.generateSpreadProduct();
                    App.generateVanillaProduct();
                    App.generateAutocallProduct();
                    ChartManager.initResizeListeners();
                } else {
                    // Chart.js未加载，延迟100ms后重试
                    setTimeout(checkChartLoaded, 100);
                }
            };
            
            checkChartLoaded();
        };
    </script>
</body>
</html>
